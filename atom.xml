<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[blog.hoatle.info]]></title>
  <link href="http://blog.hoatle.info/atom.xml" rel="self"/>
  <link href="http://blog.hoatle.info/"/>
  <updated>2013-12-03T06:58:48+00:00</updated>
  <id>http://blog.hoatle.info/</id>
  <author>
    <name><![CDATA[hoatle]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Thêm đối số vào message bundle trong OpenSocial]]></title>
    <link href="http://blog.hoatle.info/2010/01/16/them-doi-so-vao-message-bundle-trong-opensocial/"/>
    <updated>2010-01-16T21:18:00+00:00</updated>
    <id>http://blog.hoatle.info/2010/01/16/them-doi-so-vao-message-bundle-trong-opensocial</id>
    <content type="html"><![CDATA[<h2>Bài toán</h2>

<ul>
<li>Khi làm việc với message bundle trong OpenSocial để dùng nhiều ngôn ngữ trong ứng dụng tùy thuộc
vào ngôn ngữ người dùng
(<a href="http://wiki.opensocial.org/index.php?title=Localizing_OpenSocial_applications">localization</a>) đôi
khi bạn cần phải thêm đối số động vào chuỗi hiển thị.</li>
</ul>


<p>Ví dụ có chuỗi chào như này: Hello {user} trong đó user sẽ được thay bằng username tương ứng của
người dùng. Nhưng với OpenSocial api hiện tại thì không làm thế nào để thêm đối số vào được mà chỉ
có thể lấy được message tương ứng theo key cung cấp.</p>

<ul>
<li>Do vậy đây là cách làm của tớ: viết một thêm 1 class <code>eXo.social.Locale.getMsg(key)</code> và class này
cung cấp api cũng tương tự như với class <code>Prefs</code> để lấy <code>lang</code>, <code>country</code>, <code>msg</code> (class <code>Prefs</code> còn
cung cấp nhiều api khác nữa): prefs.getMsg(key). Class <code>eXo.social.Locale</code> cung cấp thêm phương thức
<code>eXo.social.Locale.getMsg(key, [val1, val2,...]);</code> để thêm đối số vào &ldquo;message bundle&rdquo;.</li>
</ul>


<!-- more -->


<h2>Giải pháp</h2>

<ul>
<li>Viết class <code>eXo.social.Locale</code>:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Locale.js</span>
</span><span class='line'><span class="cm"> * Utility for Locale, dynamic binding message bundle with arguments</span>
</span><span class='line'><span class="cm"> * Usage:</span>
</span><span class='line'><span class="cm"> * eXo.social.Locale.getLang(); the same as prefs.getLang();</span>
</span><span class='line'><span class="cm"> * eXo.social.Locale.getCountry(); the same as prefs.getCountry();</span>
</span><span class='line'><span class="cm"> * eXo.social.Locale.getMsg(key); the same as prefs.getMsg(key);</span>
</span><span class='line'><span class="cm"> * eXo.social.Locale.getMsg(key, args); dynamic binding argument to message bundle</span>
</span><span class='line'><span class="cm"> * @author  hoatle</span>
</span><span class='line'><span class="cm"> * @since   October 27, 2009</span>
</span><span class='line'><span class="cm"> * @copyright   eXo Platform</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//prefs object to get lang, country, message bundle</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">prefs</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * private function to lazily initialize prefs object</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">getPrefs</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prefs</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">prefs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gadgets</span><span class="p">.</span><span class="nx">Prefs</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">prefs</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Class definition</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">Locale</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * gets current lang</span>
</span><span class='line'><span class="cm">     * @static</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">Locale</span><span class="p">.</span><span class="nx">getLang</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">prefs</span> <span class="o">=</span> <span class="nx">getPrefs</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">prefs</span><span class="p">.</span><span class="nx">getLang</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * gets current country</span>
</span><span class='line'><span class="cm">     * @static</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">Locale</span><span class="p">.</span><span class="nx">getCountry</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">prefs</span> <span class="o">=</span> <span class="nx">getPrefs</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">prefs</span><span class="p">.</span><span class="nx">getCountry</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * alternative for prefs.getMsg(key)</span>
</span><span class='line'><span class="cm">     * uses to getMsg with provided key and substitute args</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * eg: Test for {0}, {1}</span>
</span><span class='line'><span class="cm">     * If args does not match num of {\d}, warning and try to replace by corresponding index.</span>
</span><span class='line'><span class="cm">     * {0} should be replaced by args[0], etc.,</span>
</span><span class='line'><span class="cm">     * If args not provided, functions as prefs.getMsg(key)</span>
</span><span class='line'><span class="cm">     * @param   key String</span>
</span><span class='line'><span class="cm">     * @param   opt_args Array</span>
</span><span class='line'><span class="cm">     * @static</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">Locale</span><span class="p">.</span><span class="nx">getMsg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">opt_args</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">prefs</span> <span class="o">=</span> <span class="nx">getPrefs</span><span class="p">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;key is null!&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">prefs</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Can not find resource bundle with key = &#39;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opt_args</span><span class="p">)</span> <span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//checks if number of {\d} in msg matches opt_args.length</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/{\d+}/g</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">matches</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="nx">opt_args</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;required &quot;</span> <span class="o">+</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; args, provided: &quot;</span> <span class="o">+</span> <span class="nx">opt_args</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">//substitutes by index: {0} in msg should be replaced by opt_args[0] and so on</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\d+/g</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="c1">//TODO should improve performance</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">strToReplace</span> <span class="o">=</span> <span class="nx">opt_args</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strToReplace</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;matches[&#39;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39;]: &#39;</span> <span class="o">+</span> <span class="nx">matches</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; but no opt_args[&#39;</span> <span class="o">+</span> <span class="nx">index</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">msg</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">matches</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">opt_args</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//Expose</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span><span class="p">.</span><span class="nx">social</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span><span class="p">.</span><span class="nx">social</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span><span class="p">.</span><span class="nx">social</span><span class="p">.</span><span class="nx">Locale</span> <span class="o">=</span> <span class="nx">Locale</span><span class="p">;</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Trong class trên không có gì đáng nói ngoài cách dùng regular expression để thay thế chuỗi với
pattern là <code>{0}, {1}, {2}</code> và lấy các index trong <code>{}</code> để thay bằng <code>opt_args[index]</code> tương ứng.
Bạn có thể xem thêm vài viết của <a href="http://twitter.com/sanglt">@sanglt</a>:
<a href="http://www.sanglt.com/content/su-dung-regular-expression-trong-javascript">Sử dụng regular expression trong JavaScript</a>.</p>

<ul>
<li>Chú ý: Class <code>eXo.social.Locale</code> dùng debug được @cowboy viết, đây là cách debug/log tuyệt vời và
tớ rất thích. Giờ trong tất cả các dự án hay ứng dụng nào tớ cũng dùng, sau này nhìn vào console là
biết lỗi gì ở đâu ngay, chứ dùng alert thì đúng là cực hình. Các bạn cũng nên sử dụng cách debug/log
này :).</li>
</ul>


<p>Download ứng dụng ví dụ đơn giản với cách thêm đối số vào &ldquo;message bundle&rdquo; tại
<a href="http://github.com/hoatle/opensocial/downloads">http://github.com/hoatle/opensocial/downloads</a></p>

<p>Mã nguồn tớ để ở đây: <a href="http://github.com/hoatle/opensocial/tree/master/message-bundle">http://github.com/hoatle/opensocial/tree/master/message-bundle</a></p>

<p>Đây là file ứng dụng xml:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;Module&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ModulePrefs</span> <span class="na">title=</span><span class="s">&quot;Arguments Binding Message Bundle&quot;</span>
</span><span class='line'>                 <span class="na">description=</span><span class="s">&quot;Simple-App for arguments binding with message bundle&quot;</span>
</span><span class='line'>                 <span class="na">author_email=</span><span class="s">&quot;hoatlevan@gmail.com&quot;</span>
</span><span class='line'>                 <span class="na">author_affiliation=</span><span class="s">&quot;eXo Platform&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Locale</span> <span class="na">messages=</span><span class="s">&quot;locale/ALL_ALL.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Locale</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span> <span class="na">messages=</span><span class="s">&quot;locale/en_ALL.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Locale</span> <span class="na">lang=</span><span class="s">&quot;vi&quot;</span> <span class="na">messages=</span><span class="s">&quot;locale/vi_ALL.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Require</span> <span class="na">feature=</span><span class="s">&quot;opensocial-0.8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ModulePrefs&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Content</span> <span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="cp">&lt;![CDATA[</span>
</span><span class='line'><span class="cp">        &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;style/style.css&quot; /&gt;</span>
</span><span class='line'><span class="cp">        &lt;script type=&quot;text/javascript&quot; src=&quot;script/debug.js&quot;&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="cp">        &lt;script type=&quot;text/javascript&quot; src=&quot;script/eXo/social/Locale.js&quot;&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="cp">        &lt;script type=&quot;text/javascript&quot; src=&quot;script/app.js&quot;&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="cp">        &lt;p&gt;Resource bundle rendered by server: &lt;strong&gt;__MSG_hello_world__&lt;/strong&gt;&lt;/p&gt;</span>
</span><span class='line'><span class="cp">        &lt;p&gt;Resource bundle rendered by JavaScript:&lt;/p&gt;</span>
</span><span class='line'><span class="cp">        &lt;div id=&quot;helloMsg&quot;&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="cp">        &lt;div id=&quot;helloMsgArgs&quot;&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="cp">    ]]&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/Content&gt;</span>
</span><span class='line'><span class="nt">&lt;/Module&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Có thể thấy ở trên <code>__MSG_hello_world__</code> sẽ được thay thế bằng message bundle tương ứng với key là
&ldquo;hello_world&rdquo; (tớ để tất cả các file message bundle trong thư mục <code>locale</code>).</p>

<p>Để sử dụng class <code>eXo.social.Locale</code>, chúng ta có file app.js:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">prefs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gadgets</span><span class="p">.</span><span class="nx">Prefs</span><span class="p">(),</span>
</span><span class='line'>        <span class="nx">helloWorld</span> <span class="o">=</span> <span class="nx">prefs</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="s1">&#39;hello_world&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="nx">helloWorld</span><span class="p">);</span> <span class="c1">//&quot;Hello world!&quot; if current language is English</span>
</span><span class='line'>                       <span class="c1">//&quot;Chào thế giới!&quot; if current language is Vietnamese</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//eXo.social.Locale usage</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">Locale</span> <span class="o">=</span> <span class="nx">eXo</span><span class="p">.</span><span class="nx">social</span><span class="p">.</span><span class="nx">Locale</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">helloMsgEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;helloMsg&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">helloMsgArgsEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;helloMsgArgs&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">helloMsgEl</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">Locale</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="s1">&#39;hello_world&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">helloMsgArgsEl</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">Locale</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="s1">&#39;hello_user_to_place&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;hoatle&#39;</span><span class="p">,</span> <span class="s1">&#39;Vietnam&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gadgets</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">registerOnLoadHandler</span><span class="p">(</span><span class="nx">run</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bạn có thể chạy ứng dụng này ở bất kì OpenSocial container nào. Chúc bạn code vui :D.</p>

<p>Lưu ý: Có thể sử dụng OpenSocial templates để thêm đối số vào message bundle nhưng hiện nay hầu hết
các container chưa hỗ trợ hết.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dynamic arguments binding with OpenSocial message bundle]]></title>
    <link href="http://blog.hoatle.info/2010/01/16/dynamic-arguments-binding-with-opensocial-message-bundle/"/>
    <updated>2010-01-16T19:44:00+00:00</updated>
    <id>http://blog.hoatle.info/2010/01/16/dynamic-arguments-binding-with-opensocial-message-bundle</id>
    <content type="html"><![CDATA[<h2>Problem</h2>

<ul>
<li><p>Working with OpenSocial message bundle for localization, sometimes it&rsquo;s necessary to bind dynamic
arguments to the message. For example, we have greeting message like this: <code>Hello {user}</code> in which
user will be replaced by user&rsquo;s name. But currently with OpenSocial api, we can&rsquo;t. We just can get
message bundle by the key without passing any arguments for substitution.</p></li>
<li><p>So this is my approach: using <code>eXo.social.Locale.getMsg(key)</code> the same as <code>prefs.getMsg(key)</code> and
<code>eXo.social.Locale.getMsg(key, [val1, val2,...]);</code> for dynamic arguments binding with message bundle.</p></li>
</ul>


<!-- more -->


<h2>Solution</h2>

<ul>
<li>Create <code>eXo.social.Locale class:</code></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Locale.js</span>
</span><span class='line'><span class="cm"> * Utility for Locale, dynamic binding message bundle with arguments</span>
</span><span class='line'><span class="cm"> * Usage:</span>
</span><span class='line'><span class="cm"> * eXo.social.Locale.getLang(); the same as prefs.getLang();</span>
</span><span class='line'><span class="cm"> * eXo.social.Locale.getCountry(); the same as prefs.getCountry();</span>
</span><span class='line'><span class="cm"> * eXo.social.Locale.getMsg(key); the same as prefs.getMsg(key);</span>
</span><span class='line'><span class="cm"> * eXo.social.Locale.getMsg(key, args); dynamic binding argument to message bundle</span>
</span><span class='line'><span class="cm"> * @author  hoatle</span>
</span><span class='line'><span class="cm"> * @since   October 27, 2009</span>
</span><span class='line'><span class="cm"> * @copyright   eXo Platform</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//prefs object to get lang, country, message bundle</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">prefs</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * private function to lazily initialize prefs object</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">getPrefs</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prefs</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">prefs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gadgets</span><span class="p">.</span><span class="nx">Prefs</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">prefs</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Class definition</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">Locale</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * gets current lang</span>
</span><span class='line'><span class="cm">     * @static</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">Locale</span><span class="p">.</span><span class="nx">getLang</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">prefs</span> <span class="o">=</span> <span class="nx">getPrefs</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">prefs</span><span class="p">.</span><span class="nx">getLang</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * gets current country</span>
</span><span class='line'><span class="cm">     * @static</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">Locale</span><span class="p">.</span><span class="nx">getCountry</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">prefs</span> <span class="o">=</span> <span class="nx">getPrefs</span><span class="p">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">prefs</span><span class="p">.</span><span class="nx">getCountry</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * alternative for prefs.getMsg(key)</span>
</span><span class='line'><span class="cm">     * uses to getMsg with provided key and substitute args</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * eg: Test for {0}, {1}</span>
</span><span class='line'><span class="cm">     * If args does not match num of {\d}, warning and try to replace by corresponding index.</span>
</span><span class='line'><span class="cm">     * {0} should be replaced by args[0], etc.,</span>
</span><span class='line'><span class="cm">     * If args not provided, functions as prefs.getMsg(key)</span>
</span><span class='line'><span class="cm">     * @param   key String</span>
</span><span class='line'><span class="cm">     * @param   opt_args Array</span>
</span><span class='line'><span class="cm">     * @static</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nx">Locale</span><span class="p">.</span><span class="nx">getMsg</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">opt_args</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">prefs</span> <span class="o">=</span> <span class="nx">getPrefs</span><span class="p">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;key is null!&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">prefs</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Can not find resource bundle with key = &#39;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">);</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opt_args</span><span class="p">)</span> <span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//checks if number of {\d} in msg matches opt_args.length</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/{\d+}/g</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">matches</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="nx">opt_args</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;required &quot;</span> <span class="o">+</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">&quot; args, provided: &quot;</span> <span class="o">+</span> <span class="nx">opt_args</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">//substitutes by index: {0} in msg should be replaced by opt_args[0] and so on</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\d+/g</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>            <span class="c1">//TODO should improve performance</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">strToReplace</span> <span class="o">=</span> <span class="nx">opt_args</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">strToReplace</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;matches[&#39;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39;]: &#39;</span> <span class="o">+</span> <span class="nx">matches</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; but no opt_args[&#39;</span> <span class="o">+</span> <span class="nx">index</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">msg</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">matches</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">opt_args</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//Expose</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span><span class="p">.</span><span class="nx">social</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span><span class="p">.</span><span class="nx">social</span> <span class="o">||</span> <span class="p">{};</span>
</span><span class='line'>    <span class="nb">window</span><span class="p">.</span><span class="nx">eXo</span><span class="p">.</span><span class="nx">social</span><span class="p">.</span><span class="nx">Locale</span> <span class="o">=</span> <span class="nx">Locale</span><span class="p">;</span>
</span><span class='line'><span class="p">})();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note: The <code>eXo.social.Locale</code> class uses <code>debug</code>, thanks @cowboy for his excellent JavaScript
log/debug. I love it &lt;3. All my projects and apps use it, you should also use this way of debug/log
instead of alert :).</p>

<p>Download sample app for testing at <a href="http://github.com/hoatle/opensocial/downloads">http://github.com/hoatle/opensocial/downloads</a></p>

<p>Source code available at: <a href="http://github.com/hoatle/opensocial/tree/master/message-bundle">http://github.com/hoatle/opensocial/tree/master/message-bundle</a></p>

<p>The xml app file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;Module&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ModulePrefs</span> <span class="na">title=</span><span class="s">&quot;Arguments Binding Message Bundle&quot;</span>
</span><span class='line'>                 <span class="na">description=</span><span class="s">&quot;Simple-App for arguments binding with message bundle&quot;</span>
</span><span class='line'>                 <span class="na">author_email=</span><span class="s">&quot;hoatlevan@gmail.com&quot;</span>
</span><span class='line'>                 <span class="na">author_affiliation=</span><span class="s">&quot;eXo Platform&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Locale</span> <span class="na">messages=</span><span class="s">&quot;locale/ALL_ALL.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Locale</span> <span class="na">lang=</span><span class="s">&quot;en&quot;</span> <span class="na">messages=</span><span class="s">&quot;locale/en_ALL.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Locale</span> <span class="na">lang=</span><span class="s">&quot;vi&quot;</span> <span class="na">messages=</span><span class="s">&quot;locale/vi_ALL.xml&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;Require</span> <span class="na">feature=</span><span class="s">&quot;opensocial-0.8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ModulePrefs&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Content</span> <span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="cp">&lt;![CDATA[</span>
</span><span class='line'><span class="cp">        &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;style/style.css&quot; /&gt;</span>
</span><span class='line'><span class="cp">        &lt;script type=&quot;text/javascript&quot; src=&quot;script/debug.js&quot;&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="cp">        &lt;script type=&quot;text/javascript&quot; src=&quot;script/eXo/social/Locale.js&quot;&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="cp">        &lt;script type=&quot;text/javascript&quot; src=&quot;script/app.js&quot;&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="cp">        &lt;p&gt;Resource bundle rendered by server: &lt;strong&gt;__MSG_hello_world__&lt;/strong&gt;&lt;/p&gt;</span>
</span><span class='line'><span class="cp">        &lt;p&gt;Resource bundle rendered by JavaScript:&lt;/p&gt;</span>
</span><span class='line'><span class="cp">        &lt;div id=&quot;helloMsg&quot;&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="cp">        &lt;div id=&quot;helloMsgArgs&quot;&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="cp">    ]]&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/Content&gt;</span>
</span><span class='line'><span class="nt">&lt;/Module&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the app code above, <code>__MSG_hello_world__</code> will be substituted by server with found message bundle
with key &ldquo;hello_world&rdquo; defined in message bundles files. (in <code>/locale</code> folder).</p>

<p>To test <code>eXo.social.Locale</code> class, we have the <code>app.js</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">prefs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">gadgets</span><span class="p">.</span><span class="nx">Prefs</span><span class="p">(),</span>
</span><span class='line'>        <span class="nx">helloWorld</span> <span class="o">=</span> <span class="nx">prefs</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="s1">&#39;hello_world&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="nx">helloWorld</span><span class="p">);</span> <span class="c1">//&quot;Hello world!&quot; if current language is English</span>
</span><span class='line'>                       <span class="c1">//&quot;Chào thế giới!&quot; if current language is Vietnamese</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//eXo.social.Locale usage</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">Locale</span> <span class="o">=</span> <span class="nx">eXo</span><span class="p">.</span><span class="nx">social</span><span class="p">.</span><span class="nx">Locale</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">helloMsgEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;helloMsg&#39;</span><span class="p">),</span>
</span><span class='line'>        <span class="nx">helloMsgArgsEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;helloMsgArgs&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">helloMsgEl</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">Locale</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="s1">&#39;hello_world&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">helloMsgArgsEl</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">Locale</span><span class="p">.</span><span class="nx">getMsg</span><span class="p">(</span><span class="s1">&#39;hello_user_to_place&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;hoatle&#39;</span><span class="p">,</span> <span class="s1">&#39;Vietnam&#39;</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">gadgets</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">registerOnLoadHandler</span><span class="p">(</span><span class="nx">run</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can test this sample app from any OpenSocial container. Happy coding :D.</p>

<p>P/S: We can use OpenSocial template for arguments binding with message bundle but it&rsquo;s currently
not fully supported by all containers.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gán nhiều hàm xử lý sự kiện vào một phần tử trong JavaScript]]></title>
    <link href="http://blog.hoatle.info/2010/01/09/gan-nhieu-ham-xu-ly-su-kien-vao-mot-phan-tu-trong-javascript/"/>
    <updated>2010-01-09T02:06:00+00:00</updated>
    <id>http://blog.hoatle.info/2010/01/09/gan-nhieu-ham-xu-ly-su-kien-vao-mot-phan-tu-trong-javascript</id>
    <content type="html"><![CDATA[<p>Chiều nay đang lơ tơ mơ vì vừa ngủ trưa xong (bình thường không ngủ trưa thì thôi chứ cứ ngủ trưa
xong là lơ tơ mơ, chỉ muốn ngủ hết chiều cho sướng :d) thì có bạn hỏi trên group phpvietnam như
thế này:</p>

<p><strong>&ldquo;Em có một input có thuộc tính onclick=&#8221;doSomeFunction();&rdquo; bây giờ muốn thêm
một hàm nữa ví dụ như onclick=&ldquo;doSomeFunction(); doSomeFunction2();&rdquo;. Công
việc này có làm bằng Javascript được không ah? Em cám ơn mọi người.&ldquo;</strong></p>

<p><em>Nguồn</em>: <a href="http://groups.google.com/group/phpvietnam/browse_thread/thread/c7a8688875a320c3">http://groups.google.com/group/phpvietnam/browse_thread/thread/c7a8688875a320c3</a></p>

<!-- more -->


<p>Trả lời bạn ý xong là hết cả buồn ngủ :P, tiện thể tối về viết lại kinh nghiệm cho cái blog đỡ
tủi thân :P. Khi xử lý sự kiện trong JavaScript có 4 mô hình đăng kí sự kiện được phát triển qua
thời gian. Tớ cũng nói thêm về cách sử dụng và xử lý ngữ cảnh (context) với từ khóa <code>this</code> trong các
hàm xử lý. Trong hàm xử lý phải làm sao đạt được 2 mục đích: truyền tham số vào hàm xử lý phải là
<code>event object</code> và từ khóa <code>this</code> trong hàm xử lý sự kiện đó phải là phần tử đã được đăng kí sự kiện.</p>

<p><strong>1. Inline Event Registration Model (Mô hình cổ xưa và quen thuộc nhất)</strong></p>

<p>Từ những ngày đầu khi có JavaScript và xử lý sự kiện thì chỉ có 1 cách duy nhất để gán hàm xử lý sự
kiện cho một phần tử và hiện nay nhiều người vẫn làm theo cách này. Đây là cách cổ xưa và nguyên
thủy nhất:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick=</span><span class="s">&quot;doSomething();&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Mọi người đã quá quen với cách làm như trên, đặc biệt là từ khi viết những dòng code JavaScript đầu
tiên. Viết như vậy không có gì sai cả mà nó còn tiện, nhanh, dễ hiểu và ngày xưa đến nay người ta
vẫn làm thế đấy thôi :P. Tuy nhiên, khi JavaScript phát triển hơn thì cách tiếp cận khác đi chút vì
có nhiều vấn đề nảy sinh như: làm như trên không tách biệt cấu trúc (structure &ndash; html) và hành vi
(behavior &ndash; JavaScript), làm cho code rối tinh rối mù lên, nhất là khi bạn phải lấy dữ liệu AJAX về
rồi apply template vào thì rất mệt.</p>

<p>Ta có hàm xử lý sự kiện <code>doSomething</code> như sau:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">doSomething</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// arguments[0] the same as evt</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Với trường hợp này thì <code>evt</code> là <code>undefined</code> và <code>this</code> chính là <code>window object</code>. Giờ làm thế nào để
<code>evt</code> là <code>event object</code> và <code>this</code> là element thì làm theo cách sau:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick=</span><span class="s">&quot;doSomething(event);&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Như này là đã truyền được <code>event</code> vào event handler rồi nhé. Theo tớ suy luận và thấy thì khi
element được <code>click</code> thì nó sẽ sinh ra sự kiện <code>onclick</code> như sau:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//[Native Code]</span>
</span><span class='line'><span class="nx">onclick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//event handler được gọi theo cách này</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nhớ là phải để <code>event</code> là tham số của <code>doSomething(event)</code> chứ ko được dùng tên nào khác. Nếu dùng
tên <code>evt</code> chẳng hạn thì sẽ xảy ra <code>exeption</code> do:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="nx">Native</span> <span class="nx">Code</span><span class="p">]</span>
</span><span class='line'><span class="nx">onclick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//Gọi event handler mà có đối số là evt</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span> <span class="c1">//Xảy ra exception ở đây vì evt là undefined.</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Đây là native code nên nó không cho <code>evt</code> là <code>undefined (null)</code> chứ trong các hàm bình thường thì
truyền tham số là <code>undefined (null)</code> thì không vấn đề gì, ko có exception gì hết :D.</p>

<p>Chú ý: đoạn code trên được test với chrome thì ko thấy lỗi mà vẫn chạy ầm ầm chứ IE, Firefox, Opera
đều xảy ra lỗi hết. Không biết nên chê hay khen bạn chrome đây :d.</p>

<p>Vậy là đến đây lấy được <code>event object</code> rồi, từ <code>event object</code> này lấy được rất nhiều thông tin khác
nhau như tên sự kiện, vị trí con trỏ chuột.v.v&hellip; (<code>evt.type</code>; <code>evt.charCode</code>&hellip;)</p>

<p>Giờ đến việc xử lý từ khóa <code>this</code> phải là element chứ không phải là <code>window object</code> làm như sau:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick=</span><span class="s">&quot;doSomething.call(this, event)&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Khi đó trong Native Code sẽ là:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">onclick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//this ở đây là element</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Trên chính là đoạn code hoàn chỉnh khi muốn lấy <code>this</code> và <code>event object</code>. Tớ nói kỹ ở đây thôi,
mấy đoạn sau sẽ không nói lại mấy cái này nữa.</p>

<p><strong>2. Traditional Event Registration Model</strong></p>

<p>Đây cũng là cách khá nhiều người làm khi bắt đầu muốn tách biệt giữa cấu trúc và hành vi trên trang
web. Trong code JavaScript sẽ đăng kí hàm xử lý sự kiện còn html thì chỉ là html mà thôi.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;mylink&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sau đó trong JavaScript đợi dom load hết thì cho đoạn code sau được thực thi:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">linkEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myLink&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Đây là cách truyền thống được dùng cũng không phải là ít và hiện nay nó tương thích trên tất cả các
trình duyệt lớn nên ko có gì đáng ngại cả :). Trong mô hình này thì <code>event object</code> sẽ được truyền
luôn vào hàm xử lý sự kiện, còn <code>this</code> trong hàm xử lý sự kiện cũng là element luôn :D.</p>

<p>Có thể làm thế này khi trong hàm <code>doSomething</code> muốn có <code>event object</code> và <code>this</code> là phần tử sinh ra
sự kiện.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">evt</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Trong trường hợp <code>doSomething</code> nhận thêm vài tham số thì nên viết như này:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">doSomething</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="c1">//code implementation</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// Giống với: doSomething.apply(this, [evt, param1, param2]);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tiếp đến là mô hình thứ 3 và 4 trong xử lý sự kiện. W3C model và Microsoft (IE) model. Sau đó kết
hợp hai mô hình 3 và 4 này được giải pháp khá hoàn chỉnh và có thể sử dụng ngon lành đối với mọi
trình duyệt lớn :).</p>

<p><strong>3. W3C Event Registration Model</strong></p>

<p>Theo mô hình chuẩn của bạn W3C thì đây là cách đăng kí sự kiện cho một element, có thể đăng kí
cùng lúc nhiều hàm xử lý cho 1 element:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>eventType</code> ở đây có thể là: click, mouseover, mouseout.v.v&hellip;</p>

<p><code>listener</code> chính là hàm xử lý sự kiện được thực thi khi có sự kiện <code>eventType</code> xảy ra.</p>

<p><code>useCapture</code> bạn nên để là <code>false</code> để thống nhất với trình duyệt IE, cái này liên quan tới event
phase mà tớ sẽ nói sau vào một bài viết khác.</p>

<p>Giờ có thể sử dụng như sau:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;mylink&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//javascript, chỉ chạy trên các trình duyệt Firefox, Opera, Chrome</span>
</span><span class='line'><span class="c1">// ko chạy được trên IE</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">linkEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myLink&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">//event object</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">//linkEl</span>
</span><span class='line'><span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Rất may là <code>event object</code> lại được truyền và <code>this</code> trỏ luôn đến element nên có thể gọi
<code>doSomething</code> luôn:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'><span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Với cách này bạn có thể add bao nhiêu hàm xử lý sự kiện tùy ý, khi có 1 sự kiện xảy ra thì các hàm
xử lý sự kiện đã đăng kí sẽ được thực thi và theo W3C đưa ra thì các hàm này thực thi có thể không
theo thứ tự đăng kí và hiện tại bạn không thể gọi phương thức nào của element để kiểm tra xem sự
kiện nào đó có bao nhiêu hàm xử lý sự kiện đã được đăng kí.</p>

<p>Nhưng muốn bỏ một hàm xử lý đăng kí sự kiện thì làm thế nào? Có luôn:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">element</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Cái này rất hiếm khi dùng. Khi muốn <code>remove</code> được một <code>listener</code> nào thì <code>listener</code> đó phải có tên.
Cách <code>add</code> của tớ ở trên kia dùng <code>anonymouse function</code> thì không thể <code>remove</code> được. Muốn <code>remove</code>
được thì phải làm theo cách này:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'> <span class="c1">//cho chạy một lần đầu rồi remove listener đi luôn</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">myListener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">myListener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Đấy là theo W3C, còn Microsoft lại làm theo cách khác.</p>

<p><strong>4. Microsoft Event Registration Model</strong></p>

<p>Bạn IE thì lại chơi kiểu khác, bạn ý không dùng <code>addEventListener</code> mà lại dùng:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">element</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="nx">onEventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ví dụ:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">linkEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myLink&#39;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//Chỉ chạy trên IE</span>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;onclick&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">//event object</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">//linkEl</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Muốn remove một handler (listener) thì dùng <code>detachEvent</code> cũng làm tương tự giống mô hình W3C ở trên:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;onclick&#39;</span><span class="p">,</span> <span class="nx">myListener</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Chú ý vì IE không có 2 event phase là <code>capture</code> và <code>bubble</code> mà chỉ có <code>bubble</code> phase nên khi sử dụng
với mô hình của W3C thì luôn dùng <code>false</code> với <code>useCapture</code> cho an toàn, nếu hiểu kỹ sự khác biệt của
2 phase này và có mục đích thì mới nên dùng <code>true</code>.</p>

<p><strong>5. Cuối cùng là cách kết hợp mô hình W3C với M$ (IE) thì ta có thể thiết kế và sử api đơn giản như sau:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span><span class='line'><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Phải luôn giữ <code>event object</code> được truyền vào tham số của listener và từ khóa this trong listener
phải trỏ đến element. Code như sau:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Cross browser add event listener method. For &#39;evt&#39; pass a string value with the leading &quot;on&quot; omitted</span>
</span><span class='line'><span class="cm"> * e.g. addEventListener(window,&#39;load&#39;,myFunctionNameWithoutParenthesis,false);</span>
</span><span class='line'><span class="cm"> * @param    obj object to attach event</span>
</span><span class='line'><span class="cm"> * @param    evt event name: click, mouseover, focus, blur...</span>
</span><span class='line'><span class="cm"> * @param    func    function name</span>
</span><span class='line'><span class="cm"> * @param    useCapture    true or false; if false =&gt; use bubbling</span>
</span><span class='line'><span class="cm"> * @static</span>
</span><span class='line'><span class="cm"> * @see        http://phrogz.net/JS/AttachEvent_js.txt</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'> <span class="kd">function</span> <span class="nx">addEventListener</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fnc</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">evt</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">fnc</span> <span class="o">===</span>  <span class="kc">null</span> <span class="o">||</span> <span class="nx">useCapture</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;all params are required for addEventListener&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">useCapture</span><span class="p">)</span> <span class="nx">useCapture</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">fnc</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="o">+</span><span class="nx">evt</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">fnc</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="nx">myAttachEvent</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fnc</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;on&#39;</span><span class="o">+</span><span class="nx">evt</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">myFireEvent</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="nx">evt</span><span class="p">)</span> <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//The following are for browsers like NS4 or IE5Mac which don&#39;t support either</span>
</span><span class='line'>    <span class="c1">//attachEvent or addEventListener</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">myAttachEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fnc</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">)</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="o">=</span><span class="p">{};</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">])</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">]</span><span class="o">=</span><span class="p">[];</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">];</span>
</span><span class='line'>        <span class="nx">evts</span><span class="p">[</span><span class="nx">evts</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fnc</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">myFireEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">])</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">];</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">evts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="nx">evts</span><span class="p">[</span><span class="nx">i</span><span class="p">]();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * removes event listener.</span>
</span><span class='line'><span class="cm"> * @param    obj element</span>
</span><span class='line'><span class="cm"> * @param    evt event name, &#39;click&#39;, &#39;blur&#39;. &#39;focus&#39;...</span>
</span><span class='line'><span class="cm"> * @func    function name to be removed if found</span>
</span><span class='line'><span class="cm"> * @useCapture true or false; false -&gt; bubbling event phase</span>
</span><span class='line'><span class="cm"> * @static</span>
</span><span class='line'><span class="cm"> * //TODO make sure method cross-browsered</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'> <span class="kd">function</span> <span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">)</span> <span class="p">{</span><span class="c1">//IE</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="o">+</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">func</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Khi đó cách sử dụng đơn giản như sau:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="kd">var</span> <span class="nx">linkEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myLink&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>  <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hy vọng tớ sẽ sớm viết thêm về event phase sau, chúc bạn code vui :D.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Multiple event handlers for an element in JavaScript]]></title>
    <link href="http://blog.hoatle.info/2010/01/09/multiple-event-handlers-for-an-element-in-javascript/"/>
    <updated>2010-01-09T01:55:00+00:00</updated>
    <id>http://blog.hoatle.info/2010/01/09/multiple-event-handlers-for-an-element-in-javascript</id>
    <content type="html"><![CDATA[<p>This afternoon I caught a question posted in phpvietnam group:</p>

<p><strong>&ldquo;I have an input element with the property onclick=&#8221;doSomeFunction();&rdquo;. Now I want to add another
function, ie onclick=&ldquo;doSomeFunction(); doSomeFunction2();&rdquo;, can I do this with JavaScript? Thanks
in advance!&ldquo; (translated)</strong></p>

<p><em>Source (in Vietnamese)</em>:
<a href="http://groups.google.com/group/phpvietnam/browse_thread/thread/c7a8688875a320c3">http://groups.google.com/group/phpvietnam/browse_thread/thread/c7a8688875a320c3</a></p>

<!-- more -->


<p>After answering his question, I just want to share my experience when working with JavaScript event
handler. I will show you 4 event registration models for the time beings of its use; the way to use
context and this keyword in function handler. My approach is that the event object will be passed
as 1st parameter to the function handler and this has to refer to the element triggering that event.</p>

<p><strong>1. Inline Event Registration Model</strong></p>

<p>From the first days of JavaScript, there is only one way of registering event handler and nowadays
this approach is still being used. Here we call the primitive approach:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick=</span><span class="s">&quot;doSomething();&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>People are so familiar with this event registration model, especially from the days of writing the
first lines of JavaScript code. There is nothing wrong with this kind of model, even it&rsquo;s
convenient, fast, easy to understand and people are still using this way :P. However, when
JavaScript evolves, the event registration approach changes because some problems arise: this
approach does not separate structure (html) and behaviour (JavaScript); this makes code more
complex, not very flexible to edit html. Just imagine when creating dom on the fly and constructing
new html fragment code to insert to html document? This approach does not seem fit well in this case.</p>

<p>Now working with event object and this keyword. We have the event handler function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">doSomething</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// arguments[0] the same as evt</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case, when the link element is clicked, the <code>doSomething</code> handler function will be called
and <code>evt</code> will get <code>undefined (null)</code> value and <code>this</code> will refer to <code>window</code> object. This is not my
intention, I want the event has to be event object and this has to refer to the link element. So I
have to modify the code a little bit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick=</span><span class="s">&quot;doSomething(event);&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>With above code, the event object is passed to <code>doSomething</code> handler function. In my assumption,
when link element is clicked, the <code>onclick</code> event is triggered from the browser native code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//[Native Code]</span>
</span><span class='line'><span class="nx">onclick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//event handler is called</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remember that we pass <code>event</code> as parameter to <code>doSomething</code> function but not any other name. If we
pass <code>evt</code> for example, the exception occurs:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span><span class="nx">Native</span> <span class="nx">Code</span><span class="p">]</span>
</span><span class='line'><span class="nx">onclick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//call event handler and pass evt as parameter</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span> <span class="c1">//exception occured because evt is undefined (null).</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Because this is the browser native code, it does not allow to use <code>undefined (null)</code> value there.
However, we can pass any <code>undefined</code> or <code>null</code> parameter to any our JavaScript functions as normal,
there is no exception in this case. Note that the above code is tested with chrome and it just
works (?). No exception at all but not the case for IE, Firefox, Opera, Safari. Well, in this case
I don&rsquo;t know if google chrome is good or bad?</p>

<p>By using the event parameter passed to <code>doSomething</code> function, now we can get the event object to
get many useful properties there. For example, event type, cursor location, charCode, etc.,</p>

<p>Now we have to make sure <code>this</code> in <code>doSomething</code> function has to refer to link element, not
<code>window</code> object with the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick=</span><span class="s">&quot;doSomething.call(this, event)&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>From the browser native code will trigger the <code>onclick</code> event as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">onclick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//this is the triggred element</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The above inline event registration code now works as my intention. I just explain in details in
this part only.</p>

<p><strong>2. Traditional Event Registration Model</strong></p>

<p>This is the model many developers use to separate structure and behaviour in the html document.
Html contains html only, and in JavaScript traditional event registration model will be used:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;mylink&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make sure after the dom is loaded, this code will execute:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">linkEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myLink&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This way of event registration is compatible with all major browsers. In this model, event object
is passed as the only parameter to the handler function and <code>this</code> in the handler function block
refer to linkEl.</p>

<p>Code this way to make sure <code>doSomething</code> function still has access to event object and <code>this</code> refers
to element triggering the event.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">evt</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In case the <code>doSomething</code> function has more than 1 arguments:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">doSomething</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="c1">//code implementation</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// same as: doSomething.apply(this, [evt, param1, param2]);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then we come up with 3rd and 4th event registration model: W3C model and Microsof (IE) model.
By combining these 2 models, we got the solution for event registration compatible with all major
browsers:</p>

<p><strong>3. W3C Event Registration Model</strong></p>

<p>This is the specification of W3C to register event listener (handler). By using it, we can register
as many listeners as possible.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>eventType</code>: click, mouseover, mouseout, etc.,</p>

<p><code>listener</code>: event handler function, it will be called when the element triggered eventType event.</p>

<p><code>useCapture</code>: you should always pass false to make it compatible with IE. This relates to event
phases which I will make another blog post about.</p>

<p>We can apply as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">id=</span><span class="s">&quot;mylink&quot;</span><span class="nt">&gt;</span>link<span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//javascript, run only on Firefox, Opera, Chrome, Safari</span>
</span><span class='line'><span class="c1">// can not run on IE</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">linkEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myLink&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">//event object</span>
</span><span class='line'>    <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">//linkEl</span>
</span><span class='line'><span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'><span class="nx">event</span> <span class="nx">object</span> <span class="nx">is</span> <span class="nx">passed</span> <span class="nx">as</span> <span class="nx">parameter</span> <span class="nx">and</span> <span class="k">this</span> <span class="nx">refers</span> <span class="nx">to</span> <span class="nx">linkEl</span> <span class="k">in</span> <span class="nx">event</span> <span class="nx">handler</span><span class="o">:</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'><span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>By using this approach, you can add as many listeners as possible. When an eventType triggered, all
registered listeners will be executed. Note that W3C DOM specification does not require that the
first listener registered will be executed first, these listeners can be executed by random. And
till now, there is no way to check how many listeners registered in an element.</p>

<p><em>How about removing an event listener?</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">element</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">eventType</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I rarely use <code>removeEventListener</code>. You can not remove an anonymous function. From the above code,
I use anonymous function as listener, as the result, I can not find the way to remove it. Assigning
it a name and the problem solved:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'> <span class="c1">//first run and then remove listener, no event triggered from now anymore</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">myListener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">myListener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the W3C way and M$ follows an other way.</p>

<p><strong>4. Microsoft Event Registration Model</strong></p>

<p>IE does not use <code>addEventListener</code> but <code>attachEvent</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">element</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="nx">onEventType</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>For example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">linkEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myLink&#39;</span><span class="p">);</span>
</span><span class='line'><span class="c1">//run on IE only</span>
</span><span class='line'><span class="nx">linkEl</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;onclick&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">//event object</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> <span class="c1">//linkEl</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Wanna remove a handler (listener)? Use <code>detachEvent</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">myListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;onclick&#39;</span><span class="p">,</span> <span class="nx">myListener</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that IE does not have 2 event phases (capture and bubble) but bubble phase only. So when using
W3C, you should always use <code>false</code> for <code>useCapture</code> for safety purpose :d. If you fully understand
these 2 event phases, you can pass true for <code>useCapture</code> but intentionally.</p>

<p><strong>5. At last, combine these 2 models for simple and compatible api:</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//api design</span>
</span><span class='line'><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span><span class='line'><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventType</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>My intention is that event object has to be passed as 1st parameter to listener and this has to
refer to the element in the block code. Here we come the solution:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Cross browser add event listener method. For &#39;evt&#39; pass a string value with the leading &quot;on&quot; omitted</span>
</span><span class='line'><span class="cm"> * e.g. addEventListener(window,&#39;load&#39;,myFunctionNameWithoutParenthesis,false);</span>
</span><span class='line'><span class="cm"> * @param    obj object to attach event</span>
</span><span class='line'><span class="cm"> * @param    evt event name: click, mouseover, focus, blur...</span>
</span><span class='line'><span class="cm"> * @param    func    function name</span>
</span><span class='line'><span class="cm"> * @param    useCapture    true or false; if false =&gt; use bubbling</span>
</span><span class='line'><span class="cm"> * @static</span>
</span><span class='line'><span class="cm"> * @see        http://phrogz.net/JS/AttachEvent_js.txt</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">addEventListener</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fnc</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">evt</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">fnc</span> <span class="o">===</span>  <span class="kc">null</span> <span class="o">||</span> <span class="nx">useCapture</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;all params are required for addEventListener&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">useCapture</span><span class="p">)</span> <span class="nx">useCapture</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">fnc</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="o">+</span><span class="nx">evt</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">fnc</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="nx">myAttachEvent</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fnc</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">[</span><span class="s1">&#39;on&#39;</span><span class="o">+</span><span class="nx">evt</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">myFireEvent</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="nx">evt</span><span class="p">)</span> <span class="p">};</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//The following are for browsers like NS4 or IE5Mac which don&#39;t support either</span>
</span><span class='line'>    <span class="c1">//attachEvent or addEventListener</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">myAttachEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">fnc</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">)</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="o">=</span><span class="p">{};</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">])</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">]</span><span class="o">=</span><span class="p">[];</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">];</span>
</span><span class='line'>        <span class="nx">evts</span><span class="p">[</span><span class="nx">evts</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fnc</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">myFireEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span> <span class="o">||</span> <span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">])</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">evts</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">myEvents</span><span class="p">[</span><span class="nx">evt</span><span class="p">];</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">evts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="nx">evts</span><span class="p">[</span><span class="nx">i</span><span class="p">]();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * removes event listener.</span>
</span><span class='line'><span class="cm"> * @param    obj element</span>
</span><span class='line'><span class="cm"> * @param    evt event name, &#39;click&#39;, &#39;blur&#39;. &#39;focus&#39;...</span>
</span><span class='line'><span class="cm"> * @func    function name to be removed if found</span>
</span><span class='line'><span class="cm"> * @static</span>
</span><span class='line'><span class="cm"> * //TODO make sure method cross-browsered</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">evt</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">)</span> <span class="p">{</span><span class="c1">//IE</span>
</span><span class='line'>        <span class="nx">obj</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="o">+</span><span class="nx">evt</span><span class="p">,</span> <span class="nx">func</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Use this api as simple as:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="kd">var</span> <span class="nx">linkEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myLink&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">addEventListener</span><span class="p">(</span><span class="nx">linkEl</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">doSomething</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">evt</span><span class="p">);</span>
</span><span class='line'>  <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hope that you find this post interesting, I will blog about 2 event phases soon. Happy coding :D</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tổng kết năm 2009 và những dự định cho năm 2010]]></title>
    <link href="http://blog.hoatle.info/2009/12/31/tong-ket-nam-2009-va-nhung-du-dinh-cho-nam-2010/"/>
    <updated>2009-12-31T00:41:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/12/31/tong-ket-nam-2009-va-nhung-du-dinh-cho-nam-2010</id>
    <content type="html"><![CDATA[<p>Hic, lâu lắm rồi ko viết blog, cũng vì lười, cũng vì bận nữa. Nhưng bắt đầu từ bây giờ, lại khoái
viết lại rồi, có nhiều thứ chia sẻ hơn, dù bận gì thì bận cũng sẽ phải cố viết đều đặn hơn. 8 tháng
không động đến blog, giờ ngồi mãi mới nặn ra được vài chữ. Mà tiếng Anh thì kém hẳn, bí từ kinh
khủng mà đấy là còn chưa thi xong tốt nghiệp :SS. Trong bài viết này sẽ điểm lại một số điểm nổi
bật của năm qua mà đáng lẽ những điểm này sẽ là một bài blog cơ :(.</p>

<!-- more -->


<ul>
<li><p>Tháng 2: Giữa tháng 2 bắt đầu vào làm part-time ở eXo Platform. Đầu tiên là Document Writer, sau
đó thì tham gia eXo Social team, vào làm lơ tơ mơ, nhưng giờ cũng đỡ hơn rồi :d.</p></li>
<li><p>Tháng 4: Cùng tổ chức Barcamp Hanoi 2009 với @xoai, @forty4vn, @dac2205 và bạn của @xoai bên RMIT.
Đây là lần đầu tiên tớ tham gia tổ chức một sự kiện như thế, được gặp gỡ, giao lưu với những người
có kinh nghiệm thật là thích :d. Ở Barcamp Hanoi, tớ nói về &ldquo;OpenSocial&rdquo;. OpenSocial được sử dụng ở
hầu hết các mạng xã hội lớn (trừ facebook ko theo chuẩn này), hiện nay như tớ được biết thì ở Việt
Nam có tamtay.vn và me.zing.vn đang phát triển theo chuẩn này. Còn bên eXo Social cũng đang phát
triển sản phẩm theo chuẩn này.</p></li>
<li><p>Tháng 11: Cùng anh @tuanchip (eXo CS team leader), anh Nam (CS team), chị Thủy (phòng marketing và
truyền thông), anh Việt (trưởng phòng nhân sự) giới thiệu OpenSocial và eXo Platform ở 3 trung tâm
lập trình FPT-Aptech, mục đích là giới thiệu công nghệ, tìm kiếm nhân sự, giới thiệu công ty để
các bạn định hướng về công nghệ để sau này nếu muốn làm việc ở eXo thì nên biết và tìm hiểu những
gì là cần thiết.</p></li>
<li><p>Tháng 12:</p>

<ul>
<li><p>Lần đầu tiên vào Xì-Gòn tham dự Barcamp Saigon. Vui phết, tớ vào đấy 3 ngày, thanks anh
@jishanvn đã cho ở nhờ 3 ngày :D. Ở đấy tớ nói về &ldquo;Advanced JavaScript Techniques&rdquo;.</p></li>
<li><p>Lần thứ 2 tham gia Hanoi PHP Day, lần trước thì đến nghe thôi chứ ko nói, lần này thì nói về
&ldquo;Advanced JavaScript Techniques&rdquo;, tớ chuẩn bị chủ đề này cho cả Barcamp Saigon và Hanoi PHP Day
mà :d, tuy nhiên 2 bài nói thì không giống nhau hoàn toàn đâu ;).</p></li>
</ul>
</li>
</ul>


<p>Đấy là một số điểm nổi bật của năm 2009, sang năm mới 2010 hy vọng sẽ tham gia được nhiều sự kiện
thú vị nữa, được giao lưu anh em nhiều hơn. Sang tháng 1 hy vọng thi tốt nghiệp suôn sẻ để được tự
do bay nhảy :d.</p>

<ul>
<li><p>Đầu năm hy vọng có 1 buổi offline một số anh em IT để nhậu + chém gió (Hanoi Hacker Happy Hour).</p></li>
<li><p>Hy vọng lại có Barcamp Hanoi tiếp, eXo sẽ tài trợ tiếp luôn :d.</p></li>
<li><p>Sau khi tốt nghiệp sẽ âm thầm phát triển 1 cái gì đó :D.</p></li>
<li><p>&hellip;</p></li>
</ul>


<p>Đầu tư khá nhiều sức vào project để bảo vệ ở Hanoi Aptech (cùng @huydung) nhưng cuối cùng đuối :((,
sau đấy chưa lấy lại được tinh thần để làm tiếp :|.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[End of 2009 and what's next for 2010?]]></title>
    <link href="http://blog.hoatle.info/2009/12/31/end-of-2009-and-whats-next-for-2010/"/>
    <updated>2009-12-31T00:37:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/12/31/end-of-2009-and-whats-next-for-2010</id>
    <content type="html"><![CDATA[<p>Ok, this is the end day of the year 2009 and now from I wanna blog again :d. I have many things to
write and I will try to spend some time for it. It&rsquo;s nearly 8 months since my last blog post, so in
this post, I just wanna remind some of my remarkable time and event.</p>

<!-- more -->


<ul>
<li><p>February: Joined eXo Platform SEA and worked as document writer, then join eXo Social team as
a Java Developer.</p></li>
<li><p>April: Co-organized Barcamp Hanoi 2009 (with @xoai, @forty4vn, @dac2205, @xoai&rsquo;s friend :d). It
was my first time to organize such an event, keeping in touch with interesting persons,
having meet-ups. I talked about &ldquo;OpenSocial&rdquo; there.</p></li>
<li><p>November: 3 days talking about &ldquo;OpenSocial and eXo Platform&rdquo; with @tuanchip (eXo CS team leader),
Nam (CS team), Thuy (Marketing and Communication department), Viet (HR manager) at 3 FPT-APTECH
centers.</p></li>
<li><p>December:</p>

<ul>
<li><p>My first time to Sai Gon (Ho Chi Minh city) to attend Barcamp Saigon. Special thanks to
@jishanvn :D. I talked about &ldquo;Advanced JavaScript techniques&rdquo; there.</p></li>
<li><p>My second time to attend Hanoi PHP Day, this time I talked about &ldquo;Advanced JavaScript
Techniques&rdquo; as I spent much time for writing javascript code these days.</p></li>
</ul>
</li>
</ul>


<p>For the year of 2010, hope that I can join many other interesting events, broaden my knowledge more
when I finish my school day at the end of next January. I&rsquo;m looking forward to a promising year,
the year of 2010 :d.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Làm việc cho eXo Platform hay Google đây?]]></title>
    <link href="http://blog.hoatle.info/2009/04/01/lam-viec-cho-exo-platform-hay-google-day/"/>
    <updated>2009-04-01T22:35:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/04/01/lam-viec-cho-exo-platform-hay-google-day</id>
    <content type="html"><![CDATA[<p><strong>Chú ý: Đây là bài viết trêu đùa ngày Cá Tháng Tư</strong></p>

<p>Tớ đã suy nghĩ rất nhiều. Chả là bên phía Google có đề nghị tớ qua làm việc (full-time) ở Singapore
trong vòng 2 năm sau vụ ứng dụng OpenSocial của tớ (Music-Engine) đạt giải nhì trong cuộc thi viết
ứng dụng OpenSocial khu vực Đông Nam Á do Google tổ chức. Tuy nhiên, không hiểu lý do phức tạp gì
về vụ hải quan mà tớ không thể nhận được Ipod Touch như trong phần thưởng đã ghi, thay vào đó sẽ
nhận được tiền mặt :(. Shannon Madison (là người chịu trách nhiệm chính của cuộc thi) và tớ gần đây
đã bàn luận nhiều về cơ hội việc làm này. Chị ý bảo rằng một số nhân viên của Google sẽ tham gia
BarCamp Hanoi 2009 này và sẽ hé lộ cho chúng ta biết về chiến lược của Google ở Đông Nam Á nói chung
và Việt Nam nói riêng. Giờ thì tớ phải chọn: làm việc bán thời gian ở eXo Platform hay làm việc toàn
thời gian cho Google ở Singapore trong vòng 2 năm.</p>

<!-- more -->


<p>Làm việc cho Google là một cơ hội tốt và hiếm có cho tương lai của tớ. Shannon cũng có nói về kế
hoạch văn phòng đại diện của Google ở Việt Nam, so vậy nếu tớ làm việc cho Google ở Singapore xong
2 năm thì có thể trở lại Việt Nam để làm ở văn phòng đại diện của Google ở Việt Nam. Tớ biết, đây
là cơ hội rất tốt và hiếm hoi đê tớ có thể thử sức mình khi làm việc ở nước ngoài và lại là làm việc
cho Google nữa chứ, sẽ tuyệt vời lắm chứ! Tuy nhiên, nếu tớ đồng ý làm việc ở Sing, điều đó có nghĩa
là tớ phải ngừng việc học của mình ở HUT, nghĩa là tớ phải rờ xa gia đình, bạn bè và những kỷ niệm
đẹp để đến đó làm việc. Thực sự tớ chưa bao giờ ra nước ngoài cả, nếu được vậy thì còn gì bằng.</p>

<p>Tuy nhiên cũng không phải là không có khúc mắc. Tớ vừa mới làm việc ở eXo Platform được có 1 tháng
rưỡi. Mọi thứ mới chỉ là bắt đầu và thực sự thì tớ chưa đạt được điều gì ở eXo Platform cả. Tớ đã
cố gắng nhiều để được làm việc nơi đây. Chỉ sau một thời gian ngắn ngủi như vậy thôi thì tớ biết eXo
Platform chính là môi trường tốt nhất ở Hà Nội này để cho tớ học tập, làm việc và có những người bạn
tốt. Mọi người ở đây thật tốt, dường như tớ đã quen hết với mọi người rồi. Mọi người đã chia sẻ với
nhau rất nhiều, nhất là trong các vụ: tiệc tùng đám cưới, chia tay (Jeremi), karaoke. Ngoài ra thì
tớ cũng muốn tìm hiểu về eXo Platform sau đó áp dụng vào project cuối cùng ở Hanoi Aptech sau đó là
tốt nghiệp.</p>

<p>Giờ nếu tớ đồng ý sang Sing làm việc cho Google thì tớ phải từ bỏ nhiều thứ ở nơi đây. Nếu không thì
tớ vẫn làm việc ở eXo Platform bình thường. Trời ơi!!! Làm thế nào bây giờ? Giá mà làm việc ở eXo
Platform được 1 thời gian sau đó rồi mới nhận được lời đề nghị của Google có phải tốt hơn không. Tớ
phải làm sao giờ, ai có thể cho tớ lời khuyên đúng đắn không :(?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[working for eXo Platform or Google?]]></title>
    <link href="http://blog.hoatle.info/2009/04/01/working-for-exo-platform-or-google/"/>
    <updated>2009-04-01T22:34:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/04/01/working-for-exo-platform-or-google</id>
    <content type="html"><![CDATA[<p><strong>Note: This is an April Fool&rsquo;s Day joke</strong></p>

<p>I&rsquo;m thinking so much about this. I&rsquo;ve got an offer from Google to work in Singapore for about 2
years after my OpenSocial application took the 2nd place in OpenSocial Application contest in SE
Asia. However, I can&rsquo;t touch the Ipod Touch because of customs official issue but I coud get the
money instead :(. Shannon Madison and I have been discussing about it in recent days. She said that
someone from Google will take part in BarCamp Hanoi 2009 and will tell us about some stratergy in
South East Asia in general and in Vietnam for specific. Now I have choose: having part-time job at
eXo Platform or having full-time job from Google to work in Singapore for 2 years.</p>

<!-- more -->


<p>Working for Google is a very important opportunity for my future. Shannon said to me about the plan
of Google to have representative office in Vietnam soon, so if I aggree to worked with them in
Singapore in 2 years, and then I can come back to work in the representative office of Google in
Hanoi. Well, I know this is the only chance for me to work abroad and work for Google. How
interesting it is! However, if I agree to work in Singapore, it means that I have to discontinue my
study at HUT university; it means that I have to leave my family, my friends and all my good
memories behind to work there. I&rsquo;ve never been abroad, I love it.</p>

<p>Another point to mention, I&rsquo;ve just been working at eXo Platform for 1,5 months. Everything has just
started, I haven&rsquo;t done good job in eXo. I have tried much to work here. After a short period of
time, I know eXo Platform is the best place in Hanoi for my study, work and friendship. Everyone
here is very nice, we can easily get familar with each other. We share about many things: weeding,
karaokeing, departure parties. I want to know more about eXo Platform, to understand it and apply it
for my last project in Hanoi Aptech.</p>

<p>So if I aggree to work for Google in Singapore, I have to give up so many things here. If not, I&rsquo;m
still working in eXo Platform as is. Oh my God, how can I choose one? If only after some time
working for eXo Platform, would I get this kind of offer from Google? Could anyone show me the
right way :(?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[extended deadline for Barcamp Hanoi 2009 logo design contest]]></title>
    <link href="http://blog.hoatle.info/2009/02/26/extended-deadline-for-barcamp-hanoi-2009-logo-design-contest/"/>
    <updated>2009-02-26T23:32:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/26/extended-deadline-for-barcamp-hanoi-2009-logo-design-contest</id>
    <content type="html"><![CDATA[<p>The 1st submission to Barcamp Hanoi 2009 Logo Design Contest:</p>

<p><img class="center" src="http://farm4.static.flickr.com/3541/3307608039_9a27531d47.jpg?v=0" title="The 1st submission to Barcamp Hanoi 2009 Logo Design Contest" ></p>

<p>At present we are having some logo submitted for the contest and we know that the time seems so
short for you all to complete your logo for submission.</p>

<p>After great 2nd Barcamp Hanoi organizer meetup tonight, the Logo Design Contest submission deadline
is extended to:</p>

<p><code>Saturday, March 21st, 11:59 PM (GMT+7)</code></p>

<p>So you will have more than 3 weeks from now to prepare. But don’t waste your time, start your work
right now!</p>

<p>Thanks for joining and we are looking for your great Logo for BarCamp Hanoi 2009.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[lùi hạn tham dự Cuộc thi Thiết kế Logo Barcamp Hà Nội 2009]]></title>
    <link href="http://blog.hoatle.info/2009/02/26/lui-han-tham-du-cuoc-thi-thiet-ke-logo-barcamp-ha-noi-2009/"/>
    <updated>2009-02-26T23:17:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/26/lui-han-tham-du-cuoc-thi-thiet-ke-logo-barcamp-ha-noi-2009</id>
    <content type="html"><![CDATA[<p>Logo đầu tiên gửi đến cuộc thi:</p>

<p><img class="center" src="http://farm4.static.flickr.com/3541/3307608039_9a27531d47.jpg?v=0" title="Logo đầu tiên gửi đến cuộc thi" ></p>

<p>Hiện tại chúng tôi đã nhận được những logo đầu tiên gửi đến để tham dự cuộc thi và chúng tôi cũng
biết là thời gian hơi gấp rút để bạn có thể hoàn thành tác phẩm của mình đúng thời hạn.</p>

<p>Sau cuộc họp lần 2 của ban tổ chức vừa rồi, hạn nộp logo dự thi sẽ được lùi lại đến:</p>

<p><code>Thứ bảy ngày 21 tháng 3 năm 2009 , 11:59 PM (Giờ GMT+7)</code></p>

<p>Vì vậy các bạn có hơn 3 tuần kể từ bây giờ để chuẩn bị. Nhưng đừng lãng phí thời gian, hãy bắt đầu
công việc ngay từ bây giờ!</p>

<p>Chúng tôi rất cám ơn bạn đã tham gia và đang chờ đợi những Logo ưng ý nhất của bạn dành cho
BarCamp Hanoi 2009.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OSDE - môi trường tuyệt vời cho các nhà phát triển ứng dụng OpenSocial]]></title>
    <link href="http://blog.hoatle.info/2009/02/22/osde-moi-truong-tuyet-voi-cho-cac-nha-phat-trien-ung-dung-opensocial/"/>
    <updated>2009-02-22T23:06:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/22/osde-moi-truong-tuyet-voi-cho-cac-nha-phat-trien-ung-dung-opensocial</id>
    <content type="html"><![CDATA[<p>Vừa chiều nay xong vào twitter search về opensocial, thấy mọi người đang rất quan tâm đến OpenSocia
weekendapps. Tự dưng thấy có cái link đến project này: OSDE &ndash; OpenSocial Development Environment và
yêu ngay tắp lự. Dự án là một module cho Eclipse để phát triển các ứng dụng OpenSocial trên môi
trường phát triển của các nhà phát triển.</p>

<p>Tớ vẫn còn nhớ cách đây hơn tháng vẫn code ứng dụng rồi test luôn trên các container thật như orkut,
hi5, myspace, friendster&hellip; nhưng rồi chẳng hiểu sao chỉ test được mỗi trên orkut :|. Khi đăng kí
trên các mạng này, để test ứng dụng của mình, bạn phải đăng kí, kết bạn [để test:)] và sau đó tiến
hành test và nhờ các friend-tester của mình test cho nhau :)).</p>

<p>Theo tớ đây là những bước nhàm chán và thực sự không phải cách pro trong phát triển ứng dụng. Bạn sẽ
test ứng dụng của mình như thế nào khi không có kết nối internet? OSDE chính là giải pháp hoàn hảo
và thực sự là module tuyệt vời cho Eclipse để phát triển các ứng dụng OpenSocial.</p>

<p>Bạn còn chờ gì nữa, project đó đây và hãy phát triển những ứng dụng OpenSocial tuyệt vời cho cộng
đồng nhé: <a href="http://www.eisbahn.jp/trac/osde/">http://www.eisbahn.jp/trac/osde/</a></p>

<p>Tuyệt vời, không thể nói gì hơn :). Thực sự có module này mình hào hứng hơn để phát triển các ứng
dụng OpenSocial. Code cho vui ý mà, hè hè ;)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OSDE - great for OpenSocial developers]]></title>
    <link href="http://blog.hoatle.info/2009/02/22/osde-great-for-opensocial-developers/"/>
    <updated>2009-02-22T22:53:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/22/osde-great-for-opensocial-developers</id>
    <content type="html"><![CDATA[<p>This afternoon I just hit with this project: OSDE &ndash; OpenSocial Developement Environment and loved it
at first sight :). This project is awesome for OpenSocial developers to work on their own
environment. I remembered on the first days of developing app, registered all opensocial containers,
make friends [for test :)] and then test the app. Somehow boring steps and not the pro way of app
development. What if you can not have internet connnection but you still want to test you opensocial
app. OSDE &ndash; OpenSocial Developement Environment is our solution. This is a great module for
Eclipse :).</p>

<p>Click on this link and let&rsquo;s create great apps: <a href="http://www.eisbahn.jp/trac/osde/">http://www.eisbahn.jp/trac/osde/</a></p>

<p>Everything there is good enough to code, much more easier to have your app in development stage :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cuộc thi thiết kế logo cho Barcamp Hà Nội 2009]]></title>
    <link href="http://blog.hoatle.info/2009/02/21/cuoc-thi-thiet-ke-logo-cho-barcamp-ha-noi-2009/"/>
    <updated>2009-02-21T15:14:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/21/cuoc-thi-thiet-ke-logo-cho-barcamp-ha-noi-2009</id>
    <content type="html"><![CDATA[<p><img class="center" src="http://blog.hoatle.info/images/barcamphanoismall2.png" title="Barcamp Hanoi 1 Logo" ></p>

<p>Logo hiện tại các bạn đang thấy ở phần đầu trang này là logo cũ của Barcamp Hanoi lần 1. Một vài
tháng trước, sau khi đặt logo này trên trang chủ, một số bạn đã góp ý nên thay logo cho Barcamp
Hanoi lần 2. Quan sát các Barcamp được tổ chức ở nơi khác, logo cũng được thiết kế mới cho mỗi sự
kiện hàng năm. Vì vậy những người chịu trách nhiệm tổ chức Barcamp Hanoi 2009 quyết định tổ chức một
cuộc thi thiết kế logo nhỏ. Logo thắng cuộc sẽ được sử dụng để in trên các băng rôn, T-shirt, trên
các tài liệu chính thức và sử dụng trên trang chủ. Các bạn có thể tìm hiểu thêm chi tiết về cuộc thi
ngay dưới đây:</p>

<!-- more -->


<h2>Cuộc thi thiết kế logo Barcamp Hà Nội 2009</h2>

<p>Nhằm mục đích giúp Barcamp Hanoi 2009 có một logo độc đáo và ý nghĩa.</p>

<p><strong>Phần thưởng cho người thắng cuộc</strong></p>

<ul>
<li><p>Logo thắng cuộc và tác giả sẽ được thông báo rộng rãi để cộng đồng biết đến.</p></li>
<li><p>Một T-shirt miễn phí có in logo thắng cuộc.</p></li>
</ul>


<p><strong>Hướng dẫn</strong></p>

<p>Logo nên có những đặc điểm sau:</p>

<ul>
<li><p>Thể hiện được tinh thần của Barcamp (Các bạn có thể bắt đầu bằng cách sử dụng file chuẩn logo
Barcamp ở đây)</p></li>
<li><p>Độc đáo, dễ nhận biết, có nét đặc trưng (Đây là logo của Barcamp Hanoi chứ không phải một Barcamp
chung chung)</p></li>
<li><p>Giữ được thẩm mĩ khi sử dụng dưới các hình thức khác nhau: trên web, băng rôn, T-shirt,…</p></li>
</ul>


<p><strong>Tham khảo:</strong></p>

<ul>
<li><p>File chuẩn Logo Barcamp <a href="http://barcamp.org/SpreadBarCamp">http://barcamp.org/SpreadBarCamp</a></p></li>
<li><p>Các mẫu logo ví dụ <a href="http://barcamp.org/LogoGallery">http://barcamp.org/LogoGallery</a></p></li>
<li><p>Barcamp Saigon 2008 Logo <a href="http://www.barcampsaigon.org/dokuwiki/doku.php?id=2008_org_logo">http://www.barcampsaigon.org/dokuwiki/doku.php?id=2008_org_logo</a></p></li>
<li><p>Barcamp Logos trên Google Image search <a href="http://images.google.com/images?q=Barcamp%20logo&amp;oe=utf-8&amp;rls=com.ubuntu:en-US:unofficial&amp;client=firefox-a&amp;um=1&amp;ie=UTF-8&amp;sa=N&amp;hl=en&amp;tab=wi">http://images.google.com/images?q=Barcamp%20logo&amp;oe=utf-8&amp;rls=com.ubuntu:en-US:unofficial&amp;client=firefox-a&amp;um=1&amp;ie=UTF-8&amp;sa=N&amp;hl=en&amp;tab=wi</a></p></li>
</ul>


<p><strong>Tham dự cuộc thi thế nào?</strong></p>

<ul>
<li><p>Đầu tiên hãy thiết kế một vài mẫu logo của riêng bạn. Bạn có thể đọc phần hướng dẫn ở trên để biết
thêm chi tiết.</p></li>
<li><p>Tải tác phẩm của bạn lên Flickr group <code>Barcamp Hanoi 2009 Logo Design Contest</code>.</p></li>
<li><p>Sau một tuần, các logo sẽ được đặt lên trang chủ của Barcamp Hanoi để bầu chọn công khai. Chính
các bạn quyết định logo nào sẽ được sử dụng cho Barcamp Hanoi 2009!</p></li>
<li><p>Logo thắng cuộc sẽ được sử dụng trên băng rôn, T-shirt, các tài liệu và trên web để quảng bá cho
Barcamp Hanoi 2009</p></li>
<li><p>Nếu bạn có bất cứ thắc mắc gì, có thể comment ngay vào bài viết này.</p></li>
</ul>


<p><strong>Các nguyên tắc gửi tác phẩm</strong></p>

<ul>
<li><p>Bạn có thể gửi nhiều hơn một mẫu thiết kế</p></li>
<li><p>Mẫu tải lên dưới định dạng JPG/GIF/PNG tuy nhiên bạn vẫn phải chuẩn bị phiên bản độ phân giải
cao/dạng vector để phục vụ công tác in ấn nếu như bạn thắng cuộc.</p></li>
<li><p>Khi gửi tác phẩm lên tức là bạn sẵn sàng bỏ quyền tác giả của mình với tác phẩm và đóng góp bản
thiết kế của mình cho cộng đồng.</p></li>
<li><p>Đánh dấu logo của bạn với cụm từ  “BCHN 2009 LContest” để những người chịu trách nhiệm tổ chức có
thể biết đến tác phẩm của bạn nhanh hơn.</p></li>
<li><p>Tham gia vào Flickr group Barcamp Hanoi 2009 Logo Design Contest và gửi tác phẩm của mình lên.</p></li>
<li><p>Hãy đảm bảo email đăng ký ở Flickr của bạn là email thường dùng. Điều này giúp việc liên lạc với
bạn thuận tiện hơn.</p></li>
<li><p>Đừng quên, Hạn cuối gửi logo dự thi là <strong>Thứ 7 28 tháng 2 11 giờ 59 phút tối (GMT+7)</strong>. Bạn có
<strong>một tuần</strong> để chuẩn bị, thiết kế và gửi dự thi. <strong>Hãy bắt đầu ngay bây giờ!</strong></p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Barcamp Hanoi 2009 logo design contest]]></title>
    <link href="http://blog.hoatle.info/2009/02/21/barcamp-hanoi-2009-logo-design-contest/"/>
    <updated>2009-02-21T15:06:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/21/barcamp-hanoi-2009-logo-design-contest</id>
    <content type="html"><![CDATA[<p><img class="center" src="http://blog.hoatle.info/images/barcamphanoismall2.png" title="Barcamp Hanoi 1 Logo" ></p>

<p>The current logo you’re seeing on top of this page is the logo of Barcamp Hanoi 1. Several months
ago, right after we put it on the homepage,  some people gave us feedback that we should change the
logo. And we see that other Barcamps also change their logo for each individual event. So we think
it’s right time now to announce a tiny logo design contest for Barcamp Hanoi 2009. Then we can use
the winning logo to print banner, T-shirt, official documents and put it on the homepage. You can
read more detail about the contest below:</p>

<!-- more -->


<p><strong>Barcamp Hanoi 2009 Logo Design Contest</strong></p>

<p>Help Barcamp Hanoi create a unique and meaningful logo for the event of 2009.</p>

<p><strong>Reward for the Winner</strong></p>

<ul>
<li><p>Community-Wide recognition for designing the official Barcamp Hanoi 2009 logo featured on the
official homepage.</p></li>
<li><p>A free Barcamp Hanoi 2009 T-Shirt to show off your winning design.</p></li>
</ul>


<p><strong>Submission deadline</strong></p>

<p><code>Saturday, February 28th, 11:59 PM (GMT+7)</code></p>

<p><strong>Design Guidelines</strong></p>

<p>The logo should:</p>

<ul>
<li><p>Convey the concept of Barcamp (You can use the starting files here)</p></li>
<li><p>Be distinct, unique and easily identifiable (It’s the logo of Barcamp Hanoi, not a general Barcamp)</p></li>
<li><p>Aesthetically fit in with a broad range of site/application designs</p></li>
</ul>


<p>References:</p>

<ul>
<li><p>Starting files <a href="http://barcamp.org/SpreadBarCamp">http://barcamp.org/SpreadBarCamp</a></p></li>
<li><p>Sample logos <a href="http://barcamp.org/LogoGallery">http://barcamp.org/LogoGallery</a></p></li>
<li><p>Barcamp Saigon 2008 Logo <a href="http://www.barcampsaigon.org/dokuwiki/doku.php?id=2008_org_logo">http://www.barcampsaigon.org/dokuwiki/doku.php?id=2008_org_logo</a></p></li>
<li><p>Barcamp Logos on Google Image search <a href="http://images.google.com/images?q=Barcamp%20logo&amp;oe=utf-8&amp;rls=com.ubuntu:en-US:unofficial&amp;client=firefox-a&amp;um=1&amp;ie=UTF-8&amp;sa=N&amp;hl=en&amp;tab=wi">http://images.google.com/images?q=Barcamp%20logo&amp;oe=utf-8&amp;rls=com.ubuntu:en-US:unofficial&amp;client=firefox-a&amp;um=1&amp;ie=UTF-8&amp;sa=N&amp;hl=en&amp;tab=wi</a></p></li>
</ul>


<p><strong>How it works</strong></p>

<ul>
<li><p>First, create your Logo design. View the Design Guidelines for more details.</p></li>
<li><p>Upload your design to the contest-specific Flickr group <code>Barcamp Hanoi 2009 Logo Design Contest</code>
for review.</p></li>
<li><p>After a week, these designs will be posted online at the homepage of Barcamp Hanoi for public
voting. You determine the <strong>winner</strong>!</p></li>
<li><p>The winning Logo will be used on blog, websites, banners, documents and T-shirt to help promote
Barcamp Hanoi 2009.</p></li>
<li><p>If you have any additional questions, comment right below this post.</p></li>
</ul>


<p><strong> Submission &amp; Judging Criteria</strong></p>

<ul>
<li><p>You can submit more than one design.</p></li>
<li><p>Submissions can be made via JPG/GIF/PNG however please be prepared to provide high
resolution/vector graphic versions of your work.</p></li>
<li><p>As part of the submission, participants must be willing to give up all their rights to the
copyright and donate it to the community.</p></li>
<li><p>Tag your photo with the phrase “BCHN 2009 LContest“. This will allow us to search for and pull your
photo into a public image gallery.</p></li>
<li><p>Join the contest-specific Flickr group Barcamp Hanoi 2009 Logo Design Contest and add your image
to the image pool.</p></li>
<li><p>Make sure your Flickr account is linked to an active email address; this is the only means of
contacting the winner!</p></li>
<li><p>Don’t forget, <strong>the submission deadline is Saturday, February 28th, 11:59 PM (GMT+7)</strong>. You have a
week from now to prepare and submit your logo. <strong>Start right now!</strong></p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Barcamp Hanoi 2 will come soon :)]]></title>
    <link href="http://blog.hoatle.info/2009/02/20/barcamp-hanoi-2-will-come-soon/"/>
    <updated>2009-02-20T08:11:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/20/barcamp-hanoi-2-will-come-soon</id>
    <content type="html"><![CDATA[<p>Hi everyone,</p>

<p>To tell the truth, I&rsquo;m a little envious of some HCM city (Saigon) geeks&#8217; activities, especially about Barcamp Saigon 1 and their #H3 :(. What about in Hanoi? Just correct me if I&rsquo;m wrong but it seem there
hasn&rsquo;t been any such interesting events in Hanoi. Here I just want to mention and introduce Barcamp Hanoi 2. You can just google some keyworks orderly to get info: barcamp to have general ideas about what is barcamp, barcampsaigon to know what Saigon geeks did to complete the task of organizing barcamp saigon 1. Then the last keywork is barcamphanoi to know more about Barcamp Hanoi organization status :). And then I will call for organizers + volunteers + participants + some more other things :)</p>

<!-- more -->


<p>Firstly, about Barcamp Hanoi 2. Why 2? Good question :P, do you know that Barcamp Hanoi 1 was first organized in Vietnam, esp. in Hanoi :). Just check this: <a href="http://blog.exoplatform.org/2007/12/28/barcamp-hanoi/">http://blog.exoplatform.org/2007/12/28/barcamp-hanoi/</a> So, Barcamp Hanoi 1 was organized by eXo employees (esp. by jeremi) just in internal eXo Platform SEA employees. And Now we (Hanoi geeks, bloggers, volunteers&hellip;) are organizing Barcamp Hanoi 2.</p>

<p>After the great success of Barcamp Saigon 1, some efforts to organize Barcamp Hanoi 2
started but in slow progress. Sometime it was supposed to happen before Tet holiday, then just some weeks after Tet holiday. But now we&rsquo;re still preparing for it and the progress is very fast. This post is also
for the purpose of preparation for Barcamp Hanoi 2. Please just check out what is happening in
Barcamp Hanoi 2 organization: <a href="http://groups.google.com.vn/group/barcamphanoi?hl=en.">http://groups.google.com.vn/group/barcamphanoi?hl=en.</a>
So here I&rsquo;m calling for organizers for Barcamp Hanoi 2 :). It&rsquo;s open to everyone :). Now the number of organizers can not be counted more than 10 and there are many things to do. Some points just remember: Just join in organizer team when you have passionation + know the spirit of barcamp :). Some volunteers needed for doing other things like food-prepare (don&rsquo;t worry, you do not have to cook any meal :P),
T-shirt design (for designers), sponsorship for persuasive speakers and many other things you can do for Barcamp Hanoi 2.</p>

<p>To participants: Know about barcamp spirit, know about barcamp rules, huh :P. No audience (exept for volunteers), just participants: think about what you will share for Barcamp Hanoi 2 (IT based topic),
and what topics you&rsquo;re interesting. We will have some forms to get info soon. We will make Barcamp Hanoi 2 as great and relaxed as possible. If too many people will go for registering Barcamp Hanoi 2, we will have
to filter out out some people :( because of time + venue + other problems.</p>

<ul>
<li><p>Some expectations:</p>

<ul>
<li>What: call it Barcamp Hanoi 2 ;)</li>
<li>When: April 12 (supposed)</li>
<li>Where: RMIT Hanoi or Genetic BK or other?</li>
<li>Who: any one interested in joining barcamp, participants but not audience :)</li>
<li>How many people there: About 200 geeks. So think about some interesting topics to have your seat at Barcamp Hanoi 2. The seats are limited :)</li>
<li>official tag for Barcamp Hanoi 2: barcamphanoi</li>
<li>official website for Barcamp Hanoi 2 will be updated soon, just check it here <a href="http://barcamphanoi.org">http://barcamphanoi.org</a></li>
<li>Twitter to follow: <a href="http://twitter.com/barcamphanoi">http://twitter.com/barcamphanoi</a></li>
</ul>
</li>
</ul>


<p>Links:</p>

<ul>
<li>Google group for organizers: <a href="http://groups.google.com.vn/group/barcamphanoi?hl=en">http://groups.google.com.vn/group/barcamphanoi?hl=en</a> (English)</li>
</ul>


<p>Hey, it&rsquo;s time for us to join Barcamp Hanoi 2. What you are waiting for? Spread the world about this event is a resprectedly helpful action.</p>

<p>Just ping some of us here to get more info:</p>

<ol>
<li>Hoat Le (<a href="http://hoatle.net">http://hoatle.net</a>)</li>
</ol>


<p>email: hoatlevan at gmail dot com</p>

<p>yahoo: wild_tiger8607</p>

<p>skype: hoatlevan</p>

<p>twitter: <a href="http://twitter.com/hoatle">http://twitter.com/hoatle</a></p>

<p>Thanks for reading :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Barcamp Hà Nội 2 đang tiến rất gần :)]]></title>
    <link href="http://blog.hoatle.info/2009/02/20/barcamp-ha-noi-2-dang-tien-rat-gan/"/>
    <updated>2009-02-20T05:27:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/20/barcamp-ha-noi-2-dang-tien-rat-gan</id>
    <content type="html"><![CDATA[<p>Chào các anh-chị-em-bạn, nói tóm lại là chào mọi người :P
Tớ tên là Hoạt. Để biết thêm chi tiết google với từ khoá là hoatle hộ tớ với :).</p>

<p>Nói thật là tớ hơi ghen tị với một số hoạt động của các bạn ở thành phố HCM (tên dài :(, gọi là Sài Gòn nha), đặc biệt là Barcamp Saigon 1 và #H3 :(. Còn ở Hà Nội thì sao? Có phải là tớ sai khi nói rằng hầu như ở Hà Nội không có những hoạt động như thế này. Nhưng mà tớ xin chỉ nói và giới thiệu về Barcamp Hanoi 2 ở đây vì đây là topic cần nói, còn những cái khác tớ không đề cập thì các bạn có thể tự tìm hiểu thêm. Để biết thêm 1 số thông tin cần thiết trước khi đọc tiếp, bạn có thể tìm trên google với lần lượt những từ khoá sau đây: barcamp để tìm hiểu thông tin chung về barcamp, các quy tắc, phong cách&hellip;; tiếp đến là barcampsaigon để biết thêm thông tin về Barcamp Saigon 1, cách các bạn ở đấy tiến hành tổ chức và có các hoạt động gì, topic gì&hellip; Và từ khoá cuối cùng là barcamphanoi để biết thêm thông tin về tình hình tổ chức Barcamp Hanoi 2 lần này. Giới thiệu 1 chút về Barcamp Hanoi 2, tớ sẽ kêu gọi thêm 1 số bạn vào organizer team + tình nguyện + người tham dự cùng một số thứ linh tinh khác :P</p>

<!-- more -->


<p>Đầu tiên là về Barcamp Hanoi 2. Tại sao lại là 2? Bạn có biết là Barcamp Hanoi 1 đã được tổ chức lần đầu tiên ở Việt Nam, đặc biệt hơn là ở Hà Nội. Tớ chắc chắn là rất ít người biết đến bởi vì bạn xem link sau <a href="http://blog.exoplatform.org/2007/12/28/barcamp-hanoi/.">http://blog.exoplatform.org/2007/12/28/barcamp-hanoi/.</a> Đấy, sẽ rất ít người biết bởi vì Barcamp Hanoi 1 được tổ chức nội bộ bởi nhân viên eXo Platform SEA, đặc biệt người đề xướng là jeremi. Còn bây giờ bọn tớ (Một số geek, blogger, tình nguyện ở Hà Nội) đang tổ chức Barcamp Hanoi 2.
Sau sự thành công của Barcamp Saigon 1 (<a href="http://barcampsaigon.org">http://barcampsaigon.org</a>), mới đầu Barcamp Hanoi 2 được khởi xướng và tiến hành nhưng với tốc độ khá chậm. Có lúc định ngày là trước tết cơ, xong không ổn lại bàn dồn ngày sau tết vài tuần. Nhưng đến giờ thì bọn tớ vẫn đang chuẩn bị cho nó. Tuy nhiên hiện quá trình chuẩn bị đang được gấp rút chuẩn bị, viết bài post này cũng là bước chuẩn bị đó. Để biết thêm thông tin về tình hình tổ chức Barcamp Hanoi 2, bạn có thể xem ở google group của nhóm tại: <a href="http://groups.google.com.vn/group/barcamphanoi?hl=en.">http://groups.google.com.vn/group/barcamphanoi?hl=en.</a></p>

<p>Giờ thì đến tiết mục kêu gọi thêm nhà tổ chức cho Barcamp Hanoi 2 :). Mọi người đều có thể tham gia.  Hiện tại số người tổ chức không quá 10 người và có rất nhiều thứ phải làm. Tuy nhiên để tham gia tổ chức bạn nên nhớ là: Chỉ tham gia vào đội tổ chức khi bạn thật sự hứng thú và biết về tinh thần của barcamp :). Bọn tớ cũng cần một số tình nguyện viên để cùng mọi người thực hiện những công việc khác như: chuẩn bị đồ ăn trưa (đừng lo, không ai phải vào bếp đâu mà sợ :P), thiết kế T-shirt hoặc Logo (cho dân thiết kế), đi xin tài trợ dành cho những bạn nói dễ thuyết phục, viết blog về sự kiện, viết bài đăng báo&hellip; và còn nhiều thứ khác nữa bạn có thể giúp Barcamp Hanoi 2.</p>

<p>Đối với các bạn tham dự: Biết về tinh thần của barcamp, biết về quy tắc của barcamp, ok :P. Không có người nghe (trừ những tình nguyện viên), còn lại đều phải là người tham gia: hãy nghĩ về chủ đề bạn sẽ nói ở Barcamp Hanoi 2 lần này (liên quan IT). Bọn tớ sẽ có 1 số form điền thông tin sớm nhất có thể ;). Bọn tớ sẽ cố gắng chuẩn bị và làm cho Barcamp Hanoi 2 càng đông, càng vui càng tốt. Nếu như có quá nhiều người đăng kí tham gia Barcamp Hanoi 2, bọn tớ rất tiếc sẽ phải loại bỏ để có đủ số người dự tính (khoảng 200) vì lí do thời gian + địa điểm + nhiều vấn đề khác nữa.</p>

<p>Một số dự tính:</p>

<ul>
<li>What: Sự kiện này là Barcamp Hanoi nha ;)</li>
<li>When: Có thể là ngày 12 tháng 4.</li>
<li>Where: Chưa biết được, có thể là RMIT Hanoi hoặc Genetic BK hoặc địa điểm khác?</li>
<li>Who: Bất kì ai quan tâm và muốn tham gia barcamp, tất nhiên là người tham gia chứ không phải là khán giả nha :)</li>
<li>Bao nhiêu người ở đấy: Khoảng 200 người. Bạn hãy nghĩ về chủ đề thú vị để còn có suất ở Barcamp Hanoi 2 chứ. Số ghế là có hạn.</li>
<li>Tag chính thức cho tất tần tật những gì liên quan đến Barcamp Hanoi: barcamphanoi</li>
<li>Website chính thức sẽ đang được cập nhật: <a href="http://barcamphanoi.org">http://barcamphanoi.org</a></li>
<li>Folllow twitter để được update những thông tin mới nhất: <a href="http://twitter.com/barcamphanoi">http://twitter.com/barcamphanoi</a></li>
</ul>


<p>Đấy, đã đến lúc mọi người tham gia Barcamp Hanoi 2 rồi. Bạn còn chờ gì nữa? Ít nhất thì bạn cũng tham gia và giúp đỡ Barcamp Hanoi 2 rất nhiều khi cho bạn bè, mọi người biết về Barcamp Hanoi 2.</p>

<p>Liên kết:
&ndash; Google group cho các bạn tổ chức thảo luận: <a href="http://groups.google.com.vn/group/barcamphanoi?hl=en">http://groups.google.com.vn/group/barcamphanoi?hl=en</a></p>

<p>Nếu cần biết thêm thông tin, liên lạc với bọn tớ:</p>

<ol>
<li>Lê Văn Hoạt (<a href="http://hoatle.net">http://hoatle.net</a>)</li>
</ol>


<p>email: hoatlevan at gmail dot com</p>

<p>yahoo: wild_tiger8607</p>

<p>skype: hoatlevan</p>

<p>twitter: <a href="http://twitter.com/hoatle">http://twitter.com/hoatle</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ngày làm việc đầu tiên ở eXo Platform SEA]]></title>
    <link href="http://blog.hoatle.info/2009/02/17/ngay-lam-viec-dau-tien-o-exo-platform-sea/"/>
    <updated>2009-02-17T03:11:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/17/ngay-lam-viec-dau-tien-o-exo-platform-sea</id>
    <content type="html"><![CDATA[<p>Hôm nay là ngày làm việc đầu tiên cho eXo Platform SEA, làm việc ở đây hơi bị ổn :). Từ tết đến giờ mới lại viết blog, một phần vì bận, 1 phần vì chuyển mạng qua fpt nhưng lại không được vì max thuê bao, lại quay lại dùng mạng của vietel, chậm kinh khủng, 1 máy down film cái là mạng không chạy được luôn => lại bị hạn chế down film :(. Giờ mọi thứ gần như trở lại bình thường thì hoạt động viết blog sẽ trở lại bình thường. Sắp tới có lẽ viết nhiều về Java + các sản phẩm của eXo vì làm việc nhiều với nó mà :).</p>

<!-- more -->


<p>Được làm việc ở eXo<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> cũng là may mắn, có bao giờ (dám) nghĩ là sẽ là việc ở đây đâu vì ở eXo không tuyển part-time mà hầu như các công ty cũng không tuyển part-time đâu. May mắn được biết và có một số trao đổi với Jeremi<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> từ sau đợt Opensocial Hackathon Hà Nội<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>. Sau hackathon, tớ có liên lạc với Jeremi và hẹn một buổi cafe ở eXo xem Jeremi có giúp gì được tớ không. Tớ cũng chỉ nghĩ là tới gặp nói chuyện làm quen, nhưng sau đó Jeremi có hỏi về việc học, về kinh nghiệm, gợi ý cho tớ làm technical document writer cho eXo. Quá tốt, tớ cũng cần đi làm + sang kì tới thực tập ở Bách Khoa rồi, đi thực tập phải làm gì liên quan đến tiếng Anh => vị trí này là ổn rồi, kì tới cứ thế mà tiếp tục làm chứ chả lo phải đi liên hệ thực tập nữa :)). Tuy được Jeremi gợi ý + giúp như vậy nhưng cũng chỉ là bước đầu chuẩn bị thôi. Sau đó là nộp CV, có bài test tiếng Anh nhẹ nhàng, tiếp theo là phỏng vấn 2 lượt, lượt thứ nhất với 3 anh để kiểm tra kiến thức về Java (chưa nhớ được tên anh này), kiến thức về OpenSocial (anh Tùng) và kỹ năng viết tài liệu (anh Công). Phỏng vấn lượt 2 tiếp theo là với Brice Revenant<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup> &ndash; giám đốc eXo Platform SEA hồi trước tết. Về quê nghỉ tết rồi thì nhận được email cần test thêm: gửi tài liệu mẫu hướng dẫn về Community Management cho eXo Portal. Tết bận, tranh thủ viết lúc đêm, tối hôm sau ra hàng cafe internet gửi luôn :). Tết về nhà bán hàng bận, đúng chỉ có đêm mới được sờ đến máy tính :)). Cũng may mắn là mọi thứ đều ổn, rất là vui khi làm việc ở đây :).</p>

<p>Năm đen đủi cũng qua rồi, năm ngoái thật sự mệt mỏi, mất đồ, bị lừa, khó khăn :(. Bị lừa khi giúp bạn tìm việc, bị lừa qua bọn môi giới nhà đất, 1 tháng chuyển nhà đến 3-4 lần ý :( [hận + ghét nhất là bọn môi giới), xe máy thì bị mất nữa (phải mất 1 năm làm việc mình mới có thể kiếm lại những gì đã mất :(, chắc cuối năm nay ra trường lại mua 1 cái khác). Sống ở Hà Nội điên loạn, nguy hiểm [thành phố vì hoà bình ư? Điên loạn, nguy hiểm trong hoà bình thì đúng hơn :))]. Kì 2 đại học cũng mất luôn con cào cào mới đi được 3 tháng :(. Nhưng tất cả đã qua, giờ là thời điểm của năm mới may mắn: đầu năm thì ứng dụng music-engine của tớ đạt giải nhì trong cuộc thi viết ứng dụng OpenSocial khi vực Đông Nam Á<sup id="fnref:5"><a href="#fn:5" rel="footnote">5</a></sup> &ndash; ứng dụng không phải là lớn nhưng sẽ là bàn đạp để tớ tiếp tục phát triển nó :). Có một số đề nghị tham gia các team, nhưng mà phải từ chối vì đã nhận lời làm ở eXo rồi. Đấy, lúc tìm việc mãi không ra, đến khi tìm được rồi lại thế đấy :)). Nói chung là kiểu này chả sợ thất nghiệp, kể cả trong thời kì suy thoái kinh tế thế giới thế này :). Barcamp Hà Nội 2 vẫn đang được chuẩn bị, eXo sẽ là một trong những nhà tài trợ chính. Có vẻ như quá trình chuẩn bị cho Barcamp Hà Nội 2 rất chậm, thông tin rất ít, mà không thấy có organizer nào nữa ngoài @xoài &ndash; Ninh Nguyen :(. Tớ sẽ trao đổi thêm với Brice, nếu được tạo điều kiện về thời gian sẽ cố gắng tham gia tổ chức cho Barcamp, còn không thì cũng sẽ bằng cách này hay cách khác tìm người cùng tổ chức, lên kế hoạch&hellip; Sau đó tớ cũng dự định sẽ có có 1 section, nhưng chưa biết về cái gì đây :D. Sang năm sẽ là một năm chuyển đổi lớn, có nhiều thời gian hơn sau khi tốt nghiệp ở trường + học xong ở HN-Aptech. Mệt thêm năm nay nữa thôi: Sáng học ở trường (5/7) + Chiều đi làm (5/7) + Tối học ở HN-Aptech(4/7). Học xong về ăn cơm + ngủ khoảng 3-4 tiếng. Sau đó dậy làm đủ các mọi việc: làm bài + duyệt web + viết blog&hellip;</p>

<p>Mấy hôm đầu chưa phải làm gì, được training để hiểu các sản phẩm, cách dùng&hellip; Mai training tiếp về WebOS sau đó là có 1 bài test kiểm tra chất lượng :). Mọi người ở đây đều cởi mở + tốt nữa. Được biết thêm 1 số anh chị nữa: anh Tùng (eXo Social project leader) và anh Trọng (Portal team leader) từ Hackathon, anh Công (tester) từ buổi phỏng vấn, chị Nga (document writer) và chị Hằng (training cho tớ + 1 anh nữa mới đến).
Đội hình đội ngũ ở đây [chưa cập nhật nên chưa thấy cái mặt tớ :))] <a href="http://wiki.exoplatform.org/xwiki/bin/view/Main/Team.">http://wiki.exoplatform.org/xwiki/bin/view/Main/Team.</a></p>

<p>Hôm nay buổi đầut tiên cũng có trao đổi với Brice về công việc, tớ có thể switch đến vị trí developer hoặc các vị trí khác nếu có khả năng :), còn ít nhất là nên làm 2 tháng viết docs để tìm hiểu các sản phẩm trước đã.
Jeremi làm việc cho eXo gần 2 năm, chuẩn bị mở công ty riêng ở Trung Quốc với 1 số bạn ở Thái Lan. Jeremi tốt + giỏi + cao-to-đẹp-zai; bạn girl nào cần giới thiệu thì tớ cũng không giới thiệu đâu vì Jeremi có bạn gái là người mẫu rồi thì phải :).</p>

<p>Một năm bận rộn + đầy hứa hẹn, Yeah :)</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>http://exoplatform.com<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>http://jeremi.info<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>http://blog.hoatle.info/2008/12/14/opensocial-hackathon-ha-noi/<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>http://www.linkedin.com/pub/dir/brice/revenant<a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
<li id="fn:5">
<p>http://blog.hoatle.info/2008/11/15/cuoc-thi-viet-ung-dung-opensocial-khu-vuc-dong-nam-a/<a href="#fnref:5" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[my first working day at eXo Platform SEA]]></title>
    <link href="http://blog.hoatle.info/2009/02/17/my-first-working-day-at-exo-platform-sea/"/>
    <updated>2009-02-17T02:06:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/02/17/my-first-working-day-at-exo-platform-sea</id>
    <content type="html"><![CDATA[<p>Today is my first working day at eXo Platform SEA, a nice start working day :). Hey, so long no post from my blog sice Tet holiday, now I will blog more often.</p>

<!-- more -->


<p>I&rsquo;m the lucky one to have chance working at eXo<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> , I&rsquo;ve never thought about it before knowing and meeting Jeremi<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> since Opensocial Hackathon in Hanoi<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>. After the hackathon, Jeremi and I had some discussion, he just introduced me to apply for a position at eXo &ndash; a position where my English learning at HUT and computer learning at HN-Aptech meets, so the best position is document writer. I have some good points of writing English, I will write technical documents for eXo, nice and thank Jeremi so much! Though, this is just the very first step to join eXo. I had English test, interview with 3 guys to check general Java knowledge, openSocial knowledge (Tung) and document writing skill (Cong) and then continue my interview with Brice Revenant<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup> &ndash; manager at eXo Platform SEA before our Tet holiday. I had another more test for writing a sample of user guide for comminity management when I was home. Lucky me, everything was nice and today I&rsquo;m very pleased to have my first working day and now blogging about it :).</p>

<p>The unlucky year passed by, last year I lost many things and had so many hardships: I was cheated when helping my friend finding a job, cheated to get address for renting, my motorbike was stolen (I will work hard to buy another by the end of this year), so living in Hanoi is really really dangerous [dangerous in peaceful :))], so I should be more and more and more careful. My bike was stolen at the second term at HUT, too :(. Now the new time for new year: my OpenSocial App took second prize at SE Asia OpenSocial Application contest, however, it is still in developement, hope to release it soon. Got some job offers which is very nice at the time of the world economic meltdown :D. Barcamp Hanoi 2 is being prepared, eXo will be one of the sponsers. I hope that I will have more time to wake everything up, Barcamp Hanoi 2 now seems slow in progress, I&rsquo;m preparing to have a session for Barcamp, too :). Next year will be my next big one after university graduation, more time for work, for meetup :).</p>

<p>Today I had some training to have basic ideas about Portal, how to use and organize it, cool ;). Tomorrow I will have training about WebOS and after that a test will come to check for understanding. Everyone here is nice! I just know some more guys: Tung (eXo Social project leader) and Trong (Portal team leader) from Hackathon, Cong (tester) from the interview, Nga (document writer) and Hang (give me and another guy training) &ndash; today. You can see more staffs here: <a href="http://wiki.exoplatform.org/xwiki/bin/view/Main/Team.">http://wiki.exoplatform.org/xwiki/bin/view/Main/Team.</a></p>

<p>Love this busy and promising year :)</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>http://exoplatform.com/<a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>http://jeremi.info<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>http://blog.hoatle.info/2008/12/13/opensocial-hackathon-in-hanoi/<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
<li id="fn:4">
<p>http://www.linkedin.com/pub/dir/brice/revenant<a href="#fnref:4" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gửi ứng dụng cuộc thi OpenSocial Đông Nam Á]]></title>
    <link href="http://blog.hoatle.info/2009/01/12/gui-ung-dung-cuoc-thi-opensocial-dong-nam-a/"/>
    <updated>2009-01-12T17:29:00+00:00</updated>
    <id>http://blog.hoatle.info/2009/01/12/gui-ung-dung-cuoc-thi-opensocial-dong-nam-a</id>
    <content type="html"><![CDATA[<p>Vừa submit cái ứng dụng dự thi, nhưng mà không biết thế nào cả. Ứng dụng thì được test + develop ở
mỗi orkut, còn lại các container khác thì có nhiều vấn đề. Tức nhất là mình không test ngay ở eXo
Social, nếu mà chỉ cần chạy trên này là thỏa mãn điều kiện cuộc thi rồi. Chắc là người ta cũng cân
nhắc. Sau đây là một số hình chụp.</p>

<p>Khi Search + Preview + Download:</p>

<p><img class="center" src="http://farm4.static.flickr.com/3317/3183569511_9b56d9a977_o.png" title="Khi Search + Preview + Download" ></p>

<p>Khi xem ở chế độ song detail:</p>

<p><img class="center" src="http://farm4.static.flickr.com/3126/3184221303_07c0df6e96.jpg?v=0" title="Khi xem ở chế độ song detail" ></p>

<p>Viết lại cái này cho eXo Social, vừa vẽ vẽ vài cái layout, thật là pờ-zồ :), chả giống gì cái trên
cả. Kế thừa cái cũ + chính thức sang production.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Thiết kế bộ đếm trang (site-counter) đơn giản]]></title>
    <link href="http://blog.hoatle.info/2008/12/21/thiet-ke-bo-dem-trang-site-counter-don-gian/"/>
    <updated>2008-12-21T05:38:00+00:00</updated>
    <id>http://blog.hoatle.info/2008/12/21/thiet-ke-bo-dem-trang-site-counter-don-gian</id>
    <content type="html"><![CDATA[<p>Lại thêm một thứ đơn giản nữa :). Bộ đếm trang trước đây và cả bây giờ vẫn rất phổ biến. Có một số
nhà cung cấp miễn phí bộ đếm cho bạn, chỉ việc đăng kí một tài khoản + nhúng đoạn code site-counter
vào trang của bạn là xong :). Có bạn lại không thích như thế, muốn tự mình viết một cái site-counter
riêng :). Bài viết này sẽ hướng dẫn + chia sẻ 1 bộ đếm trang đơn giản bằng PHP + MySQL.</p>

<!-- more -->


<p>Vì bảng dữ liệu khá nhỏ nên có thể sử dụng SQLite làm cơ sở dữ liệu, nhưng hiện giờ cái site-counter
này của tớ chỉ đang hỗ trợ MySQL.</p>

<p>Demo: <a href="http://d9k50.net/test/term7.">http://d9k50.net/test/term7.</a> Bạn để ý thấy bộ đếm trang nằm ở góc phải phía dưới ngoài cùng,
có thống kê một số thông số nhất định về tình hình truy cập website. Bạn có thể dùng bộ đếm trang
này để theo dõi, tuy nhiên thống kê chỉ có tính chất tương đối vì chả có cái gì là tuyệt đối
(mà nói chung thì thống kê chẳng bao giờ đúng :D).</p>

<p><strong>1. Cấu trúc file</strong></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- config.php // Thông số cài đặt cơ sở dữ liệu: hostname, username, password và dabasename
</span><span class='line'>- install.php // Chạy "1 lần rồi thôi" khi lần đấu bạn cài đặt bộ đếm trang này, sau đó nên xoá luôn đi
</span><span class='line'>- site-counter-block.php // Include file này vào bất kỳ chỗ nào trong site của bạn để hiển thị thống kê
</span><span class='line'>- site-counter-block.tpl.php // Đây là file template
</span><span class='line'>- site-counter-include.php // Nên Include file này vào header để session hoạt động tốt
</span><span class='line'>- SiteCounter.class.php // SiteCounter class - quan trọng nhất
</span><span class='line'>- site-counter-block.css // Để tùy chỉnh style cho site-counter khi hiển thị
</span><span class='line'>- site-counter-test.php // Để test</span></code></pre></td></tr></table></div></figure>


<p>Đấy là các file thiết yếu nhất, còn lại những phụ kiện phụ khác như: CHANGELOG.txt, INSTALL.txt,
LICENSE.txt, README.txt, TODO.txt nữa. Ở đây chỉ bàn đến mấy file quan trọng trên thôi.</p>

<p><em>2. Lần lượt phân tích từng file</em></p>

<p>2.1 <code>config.php</code></p>

<p>Lưu cấu hình về hostname, username, password và databasename để site-counter chạy được. Khi cài đặt
thì điều đầu tiên là bạn phải điền các thông số vào trong file này.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// $Id$</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * Config file for SiteCounter to work</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * Edit to match your database, replace your_host by your host name...</span>
</span><span class='line'><span class="sd"> * your_host is the host of your database</span>
</span><span class='line'><span class="sd"> * your_username is the MySQL account of your database</span>
</span><span class='line'><span class="sd"> * your_password is the password for that account</span>
</span><span class='line'><span class="sd"> * your_database is the database name</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;HOST&#39;</span><span class="p">,</span> <span class="s1">&#39;your_host&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;USERNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;your_username&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;PASSWD&#39;</span><span class="p">,</span> <span class="s1">&#39;your_password&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nb">define</span><span class="p">(</span><span class="s1">&#39;DBNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;your_databasename&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>2.2 <code>install.php</code></p>

<p>&ldquo;Chạy 1 lần rồi thôi&rdquo; để tạo bảng. Sau khi báo tạo bảng thành công thì bạn nên xóa file này đi
luôn.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// $Id$</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @file</span>
</span><span class='line'><span class="sd"> * Install file</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * This enables to create table site_counter in your database to track visitor&#39;s information</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;config.php&#39;</span><span class="p">;</span> <span class="c1">// Configuration file</span>
</span><span class='line'><span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;CREATE TABLE site_counter (</span>
</span><span class='line'><span class="s2">   `ip` varchar(20) NOT NULL,</span>
</span><span class='line'><span class="s2">   `timestamp` int(11) NOT NULL,</span>
</span><span class='line'><span class="s2">   `visits` int(4) DEFAULT &#39;1&#39;</span>
</span><span class='line'><span class="s2">);&quot;</span><span class="p">;</span> <span class="c1">// Query to create table.</span>
</span><span class='line'><span class="nb">mysql_connect</span><span class="p">(</span><span class="nx">HOST</span><span class="p">,</span> <span class="nx">USERNAME</span><span class="p">,</span> <span class="nx">PASSWD</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Could not connect to the host!&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nb">mysql_select_db</span><span class="p">(</span><span class="nx">DBNAME</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Could not select database!&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Could not create table!&#39;</span><span class="p">);</span>
</span><span class='line'><span class="k">echo</span> <span class="s1">&#39;Successful create table for site-counter! Please delete this install.php file by now.&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ở đây sau khi chạy thành công sẽ tạo được bảng <code>site_counter</code> với 1 số trường sau: <code>ip (distinct)</code>,
<code>timestamp</code>, <code>visits</code>. Nếu chưa có <code>ip</code> trong bảng thì <code>insert</code>, nếu có rồi và là <code>session</code> mới thì
<code>update</code> tăng <code>visits</code> lên 1. Chỉ thế thôi.</p>

<p>2.3 <code>SiteCounter.php</code></p>

<p>Quan trọng bậc nhất và là cái đáng bàn nhiều nhất. Tuy nhiên khi nhìn vào source code là bạn có thể
biết được cách hoạt động của nó luôn.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// $Id$</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * start session handler to avoid repetitive request info (visits) update for each session</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * Is there any other better solution???</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nb">session_start</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * SiteCounter class to track and update basic site&#39;s info</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * This is a Singleton Class to track and update basic site&#39;s info</span>
</span><span class='line'><span class="sd"> * such as: IP, Visits, Total hits, Online, Unique visitors</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * @copyright  hoatle (hoatle.net)</span>
</span><span class='line'><span class="sd"> * @author     hoatle</span>
</span><span class='line'><span class="sd"> * @license    http://opensource.org/licenses/gpl-license.php GNU Public License</span>
</span><span class='line'><span class="sd"> * @version    1.0</span>
</span><span class='line'><span class="sd"> * @link       http://hoatle.net/Project-Site-Counter</span>
</span><span class='line'><span class="sd"> * @since      Class available since Release 1.0</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">class</span> <span class="nc">SiteCounter</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * static property to hold singleton instance</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @static</span>
</span><span class='line'><span class="sd">     * @var SiteCounter</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">static</span> <span class="nv">$instance</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * constant duration (in minutes) to get total online users</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">const</span> <span class="no">DURATION</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * ip addressquery</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @var string</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$ip</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * number of visitis to your site from  this IP address</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @var integer</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$visits</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * number of online visitors</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @var integer</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$online</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * number of total hits since your connter&#39;s first operation</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @var integer</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$totalHits</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * number of unique visitors (ip address) since your counter&#39;s first operation</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @var integer</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="nv">$unique</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * database connection id to access</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @static</span>
</span><span class='line'><span class="sd">     * @var resource</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">static</span> <span class="nv">$dbConnectionId</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::__construct()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * private so only getInstance() method can instantiate</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Get the IP address</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ip</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REMOTE_ADDR&#39;</span><span class="p">];</span>
</span><span class='line'>        <span class="c1">// Get Info from request and insert to the database</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_updateRequestInfo</span><span class="p">();</span>
</span><span class='line'>        <span class="c1">// Get Info from database and update Counter instance</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_updateCounterInfo</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::_updateRequestInfo()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Get request info and update database</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_updateRequestInfo</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Get current timestamp</span>
</span><span class='line'>        <span class="nv">$time</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
</span><span class='line'>        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM site_counter &quot;</span>
</span><span class='line'>               <span class="o">.</span> <span class="s2">&quot;WHERE `ip` = &#39;</span><span class="si">$this-&gt;ip</span><span class="s2">&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$res</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getDbConnection</span><span class="p">());</span>
</span><span class='line'>        <span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_object</span><span class="p">(</span><span class="nv">$res</span><span class="p">);</span>
</span><span class='line'>        <span class="c1">// Check ip existence in the table</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nv">$row</span><span class="o">-&gt;</span><span class="na">ip</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// If ip exists, update visits</span>
</span><span class='line'>          <span class="nv">$visits</span> <span class="o">=</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">visits</span><span class="p">;</span> <span class="c1">// current on database</span>
</span><span class='line'>          <span class="c1">// increase $visits on each session only</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;visitsIncreased&#39;</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>              <span class="nv">$visits</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>              <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;visitsIncreased&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;UPDATE site_counter &quot;</span>
</span><span class='line'>                 <span class="o">.</span> <span class="s2">&quot;SET `timestamp` = </span><span class="si">$time</span><span class="s2">, `visits` = </span><span class="si">$visits</span><span class="s2"> &quot;</span>
</span><span class='line'>                 <span class="o">.</span> <span class="s2">&quot;WHERE `ip` = &#39;</span><span class="si">$this-&gt;ip</span><span class="s2">&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="c1">// Else, insert into database</span>
</span><span class='line'>          <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;INSERT site_counter(`ip`, `timestamp`, `visits`) &quot;</span>
</span><span class='line'>                 <span class="o">.</span> <span class="s2">&quot;VALUES (&#39;</span><span class="si">$this-&gt;ip</span><span class="s2">&#39;, </span><span class="si">$time</span><span class="s2">, 1)&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;visitsIncreased&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getDbConnection</span><span class="p">())</span> <span class="k">or</span> <span class="k">die</span> <span class="p">(</span><span class="s1">&#39;Could not query database!&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::_updateCounterInfo()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Get database info and update Counter&#39;s attributes</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @return void</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_updateCounterInfo</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Get online visitors</span>
</span><span class='line'>        <span class="c1">// limit time</span>
</span><span class='line'>        <span class="nv">$limitTime</span> <span class="o">=</span> <span class="nb">time</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">DURATION</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span> <span class="c1">// Count in senconds</span>
</span><span class='line'>        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(*) `online` FROM site_counter &quot;</span>
</span><span class='line'>               <span class="o">.</span> <span class="s2">&quot;WHERE `timestamp` &gt; </span><span class="si">$limitTime</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">online</span> <span class="o">=</span> <span class="nb">mysql_fetch_object</span><span class="p">(</span><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getDbConnection</span><span class="p">()))</span><span class="o">-&gt;</span><span class="na">online</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Get visits</span>
</span><span class='line'>        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT `visits` FROM site_counter &quot;</span>
</span><span class='line'>               <span class="o">.</span> <span class="s2">&quot;WHERE `ip` = &#39;</span><span class="si">$this-&gt;ip</span><span class="s2">&#39;&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visits</span> <span class="o">=</span> <span class="nb">mysql_fetch_object</span><span class="p">(</span><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getDbConnection</span><span class="p">()))</span><span class="o">-&gt;</span><span class="na">visits</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Get total hits</span>
</span><span class='line'>        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT SUM(`visits`) `totalHits` &quot;</span>
</span><span class='line'>               <span class="o">.</span> <span class="s2">&quot;FROM site_counter&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">totalHits</span> <span class="o">=</span> <span class="nb">mysql_fetch_object</span><span class="p">(</span><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getDbConnection</span><span class="p">()))</span><span class="o">-&gt;</span><span class="na">totalHits</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Get the number of unique visitors</span>
</span><span class='line'>        <span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(*) `unique` FROM site_counter&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unique</span> <span class="o">=</span> <span class="nb">mysql_fetch_object</span><span class="p">(</span><span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_getDbConnection</span><span class="p">()))</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::_getDbConnection()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Get database connection resource, this is a singleton pattern. This method get config constant</span>
</span><span class='line'><span class="sd">     * from config.php file: HOST, USERNAME, PASSWD, DBNAME</span>
</span><span class='line'><span class="sd">     * @access private</span>
</span><span class='line'><span class="sd">     * @return resource $dbConnectionId</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">function</span> <span class="nf">_getDbConnection</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="o">::</span><span class="nv">$dbConnectionId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>           <span class="nx">self</span><span class="o">::</span><span class="nv">$dbConnectionId</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="nx">HOST</span><span class="p">,</span> <span class="nx">USERNAME</span><span class="p">,</span> <span class="nx">PASSWD</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error connect to host: &#39;</span> <span class="o">.</span> <span class="nx">HOST</span><span class="p">);</span>
</span><span class='line'>           <span class="nb">mysql_select_db</span><span class="p">(</span><span class="nx">DBNAME</span><span class="p">,</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$dbConnectionId</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error connect to database: &#39;</span> <span class="o">.</span> <span class="nx">DBNAME</span><span class="p">);</span>
</span><span class='line'>       <span class="p">}</span>
</span><span class='line'>       <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$dbConnectionId</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::getInstance()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * factory method to return the singleton instance</span>
</span><span class='line'><span class="sd">     * @access public</span>
</span><span class='line'><span class="sd">     * @static</span>
</span><span class='line'><span class="sd">     * @return Counter $instance</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getInstance</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// If no instance, just create one</span>
</span><span class='line'>            <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SiteCounter</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::__clone()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Prevent from object clonning</span>
</span><span class='line'><span class="sd">     * @access public</span>
</span><span class='line'><span class="sd">     * @return Exception</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;This Counter object can not be cloned!&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="cm">/*</span>
</span><span class='line'><span class="cm">     * Getter method</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * This magic getter method will return Counter&#39;s attributes if any</span>
</span><span class='line'><span class="cm">     * @acess public</span>
</span><span class='line'><span class="cm">     * @return mixed</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__get</span><span class="p">(</span><span class="nv">$property</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$methodName</span> <span class="o">=</span> <span class="s2">&quot;get</span><span class="si">{</span><span class="nv">$property</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$methodName</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$methodName</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::getIp()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Get Ip address from the current request</span>
</span><span class='line'><span class="sd">     * @access public</span>
</span><span class='line'><span class="sd">     * @return string $ip</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getIp</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ip</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::getVisits()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Get number of visits from the current request</span>
</span><span class='line'><span class="sd">     * @access public</span>
</span><span class='line'><span class="sd">     * @return integer $visits</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getVisits</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">visits</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::getOnline()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Get number of online user at the time of request</span>
</span><span class='line'><span class="sd">     * @access public</span>
</span><span class='line'><span class="sd">     * @return integer $online</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOnline</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">online</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::getTotalHits()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Get total hits from the day of site-counter&#39;s operation</span>
</span><span class='line'><span class="sd">     * @access public</span>
</span><span class='line'><span class="sd">     * @return integer $totalHits</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTotalHits</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">totalHits</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * SiteCounter::getUnique()</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * Get the total number of unique visitor (ip address)</span>
</span><span class='line'><span class="sd">     * @access public</span>
</span><span class='line'><span class="sd">     * @return integer $unique</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getUnique</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ý tưởng cho class SiteCounter: Singleton vì có thể được gọi 2 lần trong 1 file, nhưng chỉ được phép
có 1 instance trong 1 lần request. Đầu tiên là lấy ip của người dùng. Bước 1 là cập nhật cơ sở dữ
liệu (<code>_updateRequestInfo</code>): kiểm tra ip có tồn tại hay chưa, nếu chưa thì thêm 1 record vào bảng,
nếu rồi thì update visits tăng lên 1. Bước 2 là cập nhật đối tượng SiteCounter để sau đó lấy thông
tin về $ip, $visits, $online, $totalHits, $unique thông qua đối tượng được khởi tạo từ class
SiteCounter. Ví dụ:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$counter</span> <span class="o">=</span> <span class="nx">SiteCounter</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
</span><span class='line'><span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">getIp</span><span class="p">();</span> <span class="c1">// = $counter-&gt;Ip;</span>
</span><span class='line'><span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">Online</span><span class="p">;</span> <span class="c1">// = $counter-&gt;getOnline();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Có thể thấy có 2 cách lấy thuộc tính như vậy là do magic method <strong>get() được implement. Khi bạn truy
cập thuộc tính của 1 object mà không public thì hàm </strong>get() này sẽ được gọi và tham số được truyền
vào chính là property bạn gọi thông qua object. Tất nhiên là bạn cũng phải implement các hàm Getter
trước rồi đã, đây coi như chỉ là helper method mà thôi.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Getter method</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * This magic getter method will return Counter&#39;s attributes if any</span>
</span><span class='line'><span class="cm"> * @acess public</span>
</span><span class='line'><span class="cm"> * @return mixed</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">__get</span><span class="p">(</span><span class="nv">$property</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$methodName</span> <span class="o">=</span> <span class="s2">&quot;get</span><span class="si">{</span><span class="nv">$property</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$methodName</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$methodName</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>2.4 Bây giờ đến phần sử dụng class SiteCounter trên.</p>

<p>Đầu tiên là sẽ có 2 file được include vào trang theo dõi của bạn: site-counter-include.php và
site-counter-block.php để hiển thị. site-counter-include.php luôn phải được include vào header của
trang vì sử dụng session, nếu include sau 1 vài file thì rất có thể session sẽ không được tạo vì
header đã được gửi lại cho phía client => Warning.</p>

<p>File site-counter-include.php</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// $Id$</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @file tracking visitor&#39;s information</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * To track every visitor&#39;s information on every request to any page on your website,</span>
</span><span class='line'><span class="sd"> * include this file on your header or footer part or any that that is represented on</span>
</span><span class='line'><span class="sd"> * every page of your site.</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;config.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="k">require_once</span> <span class="s1">&#39;SiteCounter.class.php&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$counter</span> <span class="o">=</span> <span class="nx">SiteCounter</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>File site-conter-block.php, site-counter-block.tpl.php và site-counter-block.css để hiển thị:</p>

<p>File site-counter-block.php</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// $Id$</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @file display visitor&#39;s information</span>
</span><span class='line'><span class="sd"> *</span>
</span><span class='line'><span class="sd"> * To display visitor&#39;s information, include this file on any part of your page.</span>
</span><span class='line'><span class="sd"> * Refer to README.txt on HOW TO USE part for more information.</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="nv">$counter</span> <span class="o">=</span> <span class="nx">SiteCounter</span><span class="o">::</span><span class="na">getInstance</span><span class="p">();</span>
</span><span class='line'><span class="c1">// Get information</span>
</span><span class='line'><span class="nv">$ip</span>        <span class="o">=</span> <span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">Ip</span><span class="p">;</span>
</span><span class='line'><span class="nv">$online</span>    <span class="o">=</span> <span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">Online</span><span class="p">;</span>
</span><span class='line'><span class="nv">$visits</span>    <span class="o">=</span> <span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">Visits</span><span class="p">;</span>
</span><span class='line'><span class="nv">$totalHits</span> <span class="o">=</span> <span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">TotalHits</span><span class="p">;</span>
</span><span class='line'><span class="nv">$unique</span>    <span class="o">=</span> <span class="nv">$counter</span><span class="o">-&gt;</span><span class="na">Unique</span><span class="p">;</span>
</span><span class='line'><span class="c1">// display it</span>
</span><span class='line'><span class="k">include_once</span> <span class="err">&#39;</span><span class="nx">site</span><span class="o">-</span><span class="nx">counter</span><span class="o">-</span><span class="nx">block</span><span class="o">.</span><span class="nx">tpl</span><span class="o">.</span><span class="nx">php</span>
</span></code></pre></td></tr></table></div></figure>


<p>File site-counter-block.tpl.php:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span>
</span><span class='line'><span class="c1">// $Id$</span>
</span><span class='line'><span class="sd">/**</span>
</span><span class='line'><span class="sd"> * @file template file to display site-counter information</span>
</span><span class='line'><span class="sd"> * Availabe variables:</span>
</span><span class='line'><span class="sd"> * - $ip</span>
</span><span class='line'><span class="sd"> * - $visits</span>
</span><span class='line'><span class="sd"> * - $online</span>
</span><span class='line'><span class="sd"> * - $totalHits</span>
</span><span class='line'><span class="sd"> * - $unique</span>
</span><span class='line'><span class="sd"> */</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;div id=&quot;site-counter&quot;&gt;&lt;fieldset&gt;&lt;legend&gt;Site-Counter&lt;/legend&gt;</span>
</span><span class='line'><span class="x">&lt;div&gt;Your IP: &lt;span id=&quot;ip&quot;&gt;</span><span class="cp">&lt;?php</span> <span class="k">print</span> <span class="nv">$ip</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&lt;/span&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="x">&lt;div&gt;Your visits: &lt;span id=&quot;visits&quot;&gt;</span><span class="cp">&lt;?php</span> <span class="k">print</span> <span class="nv">$visits</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&lt;/span&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="x">&lt;div&gt;Online: &lt;span id=&quot;online&quot;&gt;</span><span class="cp">&lt;?php</span> <span class="k">print</span> <span class="nv">$online</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&lt;/span&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="x">&lt;div&gt;Total Hits: &lt;span id=&quot;total-hits&quot;&gt;</span><span class="cp">&lt;?php</span> <span class="k">print</span> <span class="nv">$totalHits</span><span class="p">;</span><span class="cp">?&gt;</span><span class="x">&lt;/span&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="x">&lt;div&gt;Unique visitors: &lt;span id=&quot;unique&quot;&gt;</span><span class="cp">&lt;?php</span> <span class="k">print</span> <span class="nv">$unique</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&lt;/span&gt;&lt;/div&gt;</span>
</span><span class='line'><span class="x">&lt;/fieldset&gt;</span>
</span><span class='line'><span class="x">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>File site-counter-block.css:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/**</span>
</span><span class='line'><span class="c"> * $Id$</span>
</span><span class='line'><span class="c"> * Styles site-counter</span>
</span><span class='line'><span class="c"> * author: hoatle</span>
</span><span class='line'><span class="c"> * website: hoatle.net</span>
</span><span class='line'><span class="c"> */</span>
</span><span class='line'>
</span><span class='line'> <span class="nf">#site-counter</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">width</span><span class="o">:</span> <span class="m">220px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">font-size</span><span class="o">:</span> <span class="m">12px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">color</span><span class="o">:</span> <span class="nb">gray</span><span class="p">;</span>
</span><span class='line'>    <span class="k">text-align</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
</span><span class='line'>    <span class="k">background-color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
</span><span class='line'>    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="nb">black</span> <span class="k">dotted</span><span class="p">;</span>
</span><span class='line'>    <span class="n">filter</span><span class="o">:</span> <span class="n">alpha</span><span class="p">(</span><span class="k">opacity</span><span class="o">=</span><span class="m">90</span><span class="p">);</span>
</span><span class='line'>    <span class="o">-</span><span class="n">moz</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">09</span><span class="p">;</span>
</span><span class='line'>    <span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">90</span><span class="p">;</span>
</span><span class='line'>    <span class="o">-</span><span class="n">khtml</span><span class="o">-</span><span class="k">opacity</span><span class="o">:</span> <span class="m">0</span><span class="o">.</span><span class="m">90</span><span class="p">;</span>
</span><span class='line'>    <span class="k">margin</span><span class="o">:</span> <span class="m">2em</span> <span class="m">0</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="nf">#site-counter</span> <span class="nt">div</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">text-align</span><span class="o">:</span> <span class="k">left</span><span class="p">;</span>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="nf">#site-counter</span> <span class="nt">div</span> <span class="nf">#ip</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="nf">#site-counter</span> <span class="nt">div</span> <span class="nf">#visits</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="nf">#site-counter</span> <span class="nt">div</span> <span class="nf">#online</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="nf">#site-couner</span> <span class="nt">div</span> <span class="nf">#total-hits</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'> <span class="nf">#site-counter</span> <span class="nt">p</span> <span class="nf">#unique</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>2.5 Xong</p>

<p>Cuối cùng là test nó với trang site-counter-test.php.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="cp">// $Id$</span>
</span><span class='line'><span class="cp">include_once &#39;site-counter-include.php&#39;;</span>
</span><span class='line'><span class="cp">?&gt;</span>
</span><span class='line'><span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'><span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;title&gt;</span>Site-Counter Test Page<span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;site-counter-block.css&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="cp">&lt;?php include_once &#39;site-counter-block.php&#39;; ?&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Chúc vui :).</p>
]]></content>
  </entry>
  
</feed>
